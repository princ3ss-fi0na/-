<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover, user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<title>–õ–µ—á–æ. –ê—Ö—É–µ–≤—à–∞—è –∑–∞—Ä—É–±–∞ –≤ –¢–µ—Ö–∞—Å–µ.</title>

<!-- Fonts: —Å—Ç—Ä–æ–≥–∏–µ –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ, —Å –≤–∞–π–±–æ–º Wild West –º–∏–Ω–∏–º–∞–ª–∏–∑–º–∞ -->
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg-top: #0c3f25; --bg-bottom: #041811; /* –ó–µ–ª–µ–Ω—ã–µ —Ç–æ–Ω–∞ –∫–∞–∫ –ø–æ–∫–µ—Ä–Ω—ã–π —Å—Ç–æ–ª */
  --accent: #f0e6d8; --accent-2: #ffd48a;
  --glass: rgba(255,255,255,0.05);
  --card-w: 76px; --card-h: 104px; --btn-radius: 16px; /* –ë–æ–ª–µ–µ –æ–∫—Ä—É–≥–ª—ã–µ –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –≤–∏–¥–∞ */
  --shadow-strong: 0 20px 50px rgba(2,6,8,0.6);
  --muted: rgba(255,255,255,0.75);
  --bottom-bar-height: 60px; /* –í—ã—Å–æ—Ç–∞ –Ω–∏–∂–Ω–µ–π –ø–∞–Ω–µ–ª–∏ */
  /* Dynamic app height for Telegram Mini Apps */
  --app-height: 100vh;
  --log-h: 140px;
}
*{box-sizing:border-box}
html,body{height:100%; margin:0; padding:0;}
body{
  font-family:"DM Sans",system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  background:
    radial-gradient(800px 360px at 85% 10%, rgba(255,200,120,0.03), transparent),
    linear-gradient(180deg,var(--bg-top),var(--bg-bottom));
  background-attachment: fixed;
  color:#fff; min-height:100vh; display:flex; flex-direction:column;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  height: var(--app-height);
  padding-top: 50px; /* –û—Ç—Å—Ç—É–ø –¥–ª—è –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏ –±–∞–ª–∞–Ω—Å–∞ */
  padding-bottom: var(--bottom-bar-height); /* –û—Ç—Å—Ç—É–ø –¥–ª—è –Ω–∏–∂–Ω–µ–π –ø–∞–Ω–µ–ª–∏ */
}

/* APP */
.app{width:100%; max-width:390px; /* –û–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö, –∫–∞–∫ –≤ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–µ */ margin:0 auto; display:flex; flex-direction:column; gap:12px; padding: env(safe-area-inset-top) 8px env(safe-area-inset-bottom) 8px;}

/* Top balance bar */
.top-balance-bar{
  position:fixed; top:0; left:0; right:0; z-index:100;
  background: rgba(12,47,37,0.95); backdrop-filter: blur(10px);
  padding:8px; border-bottom:1px solid rgba(255,255,255,0.03);
  display:flex; justify-content:center; align-items:center;
  height:50px;
}

/* Bottom bar - static, –∫–∞–∫ –≤ Telegram mini-apps */
.bottom-bar{
  display:flex; justify-content:center; align-items:center; gap:8px;
  position:fixed; bottom:0; left:0; right:0; z-index:100;
  background: rgba(12,47,37,0.95); backdrop-filter: blur(10px);
  padding:8px; border-top:1px solid rgba(255,255,255,0.03);
  height:var(--bottom-bar-height);
}
.nav-buttons{display:flex; justify-content:space-around; flex:1; gap:4px;}
.big-btn{
  background:var(--accent); color:#111; padding:4px 8px; border-radius:var(--btn-radius); font-weight:800;
  text-align:center; box-shadow:0 10px 24px rgba(0,0,0,0.28); cursor:pointer; border:none; font-size:12px;
  display:flex; flex-direction:column; align-items:center; min-width:60px;
}
.big-btn span{font-size:24px; line-height:1;} /* –ò–∫–æ–Ω–∫–∏ –∫–∞–∫ –≤ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–µ */
.balance{background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03)); padding:8px 12px; border-radius:12px; font-weight:800; color:var(--accent); display:flex; align-items:center; gap:8px; border:1px solid rgba(255,255,255,0.03); transition:all 0.3s ease; white-space:nowrap; font-size:14px; max-width:300px; overflow:hidden; text-overflow:ellipsis;}

/* Title wrap for main screens */
.title-wrap{display:flex; align-items:center; gap:12px; padding:8px 0 0 0; /* –°–¥–≤–∏–Ω—É–ª–∏ –≤–≤–µ—Ä—Ö, —É–º–µ–Ω—å—à–∏–≤ padding-top */}
.logo-card{
  width:60px; height:60px; border-radius:50%; /* –ö—Ä—É–≥–ª—ã–π –∫–∞–∫ –≤ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–µ */ background:linear-gradient(135deg,var(--accent-2),var(--accent));
  color:#111; display:flex; align-items:center; justify-content:center; font-weight:900; font-size:36px;
  box-shadow:0 18px 40px rgba(0,0,0,0.55); flex-shrink:0;
}
.title{
  font-family:'Playfair Display', serif;
  font-weight:600; font-size:18px; letter-spacing:0.2px; color:var(--accent); margin:0;
  line-height:1;
}
.subtitle{font-size:11px; color:var(--muted); margin-top:4px; font-weight:500;}

/* Shelves (intro panels) - modern cards like in Telegram apps */
.shelves{display:grid; grid-template-columns:1fr; gap:12px;}
.shelf{
  background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); border-radius:16px; padding:16px; border:1px solid rgba(255,255,255,0.03);
  box-shadow:0 10px 26px rgba(0,0,0,0.45);
}
.shelf h3{margin:0 0 8px 0; font-size:16px; color:var(--accent);}
.shelf p{margin:0; color:var(--muted); font-size:13px;}

/* Responsive adjustments for mini-app feel */
@media(max-width:600px){ 
  .nav-buttons{gap:2px;}
  .big-btn{padding:4px 6px; font-size:10px; min-width:50px;}
  .logo-card{width:50px; height:50px; font-size:30px;}
  .title{font-size:16px;}
  .subtitle{display:none;}
}

/* Global panels */
.card-panel{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border-radius:16px; padding:16px; border:1px solid rgba(255,255,255,0.03); box-shadow:0 8px 24px rgba(0,0,0,0.45);}
.small-muted{font-size:13px; color:var(--muted);}

/* Players row - static grid layout */
.players-row{display: grid; gap:4px; justify-content:center;}
.players-row[style*="grid-template-columns"] { grid-template-columns: repeat(var(--lobby-size, 3), 1fr); }
.player-chip{display:flex; flex-direction:column; align-items:center; gap:2px; padding:4px; background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border-radius:12px; width:100%; border:1px solid rgba(255,255,255,0.03); transition: none;}
.player-chip:hover{transform:none;}
.player-name{font-size:11px; font-weight:700; color:#fff; text-align:center;}
.player-status{font-size:10px; color:var(--accent-2); font-style:italic;}
.player-count{font-size:11px; color:var(--muted);}

/* Avatars - smaller for table */
.avatar{border-radius:50%; /* –ö—Ä—É–≥–ª—ã–µ –∞–≤–∞—Ç–∞—Ä—ã –∫–∞–∫ –≤ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–µ */ overflow:hidden; border:2px solid rgba(255,255,255,0.04); display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.12); color:#fff;}
.avatar.small{width:40px; height:40px; font-size:18px;}
.avatar.medium{width:48px; height:48px; font-size:20px;}
.avatar.large{width:84px; height:84px; font-size:36px;}

/* Cards - with Wild West feel but minimal */
.card{width:var(--card-w); height:var(--card-h); background:#fff; color:#111; border-radius:12px; box-shadow:0 16px 34px rgba(2,6,8,0.35); display:flex; flex-direction:column; justify-content:space-between; padding:10px; font-weight:800; user-select:none; transition:transform .18s;}
.card.back{background:linear-gradient(180deg,#0b2b21,#052015); color:#ffd; justify-content:center; align-items:center; font-size:20px; position:relative;}
.card .suit{font-size:14px;}
.card .rank{font-size:18px; text-align:center;}
.hand{display:flex; gap:8px;}

/* –ö–∞—Ä—Ç—ã –Ω–∞ –ø–æ–ª–µ –∞—Ç–∞–∫–∏ –∏ –∑–∞—â–∏—Ç—ã - —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–µ */
.table-slot .card {
  width: 60px;
  height: 84px;
  font-size: 12px;
  padding: 6px;
}
.table-slot .card .suit {
  font-size: 10px;
}
.table-slot .card .rank {
  font-size: 14px;
}

/* Table */
.table{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border-radius:16px; padding:10px; display:flex; flex-direction:column; gap:8px; border:1px solid rgba(255,255,255,0.03);}
.table-center{display:flex; gap:8px; align-items:center; justify-content:center; position: relative;}
.table-slot{width:136px; height:96px; background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border-radius:16px; padding:8px; display:flex; flex-direction:column; gap:6px; align-items:center; justify-content:center; border:1px solid rgba(255,255,255,0.03); position: relative;}

/* Controls - now in flow, no fixed */
.controls{display:flex; gap:6px; background:var(--glass); padding:8px; border-radius:12px; border:1px solid rgba(255,255,255,0.03);}
#log{display:none !important;}

/* Shop */
.shop-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:16px; margin-top:16px;}
.shop-item{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); padding:16px; border-radius:16px; border:1px solid rgba(255,255,255,0.03);}
.item-title{font-weight:700; color:var(--accent); margin-bottom:6px;}
.item-desc{font-size:13px; color:var(--muted); margin-bottom:8px;}
.price{font-weight:900; color:var(--accent); font-size:14px;}

/* Inventory */
.inv{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;}
.inv .chip{background:rgba(255,255,255,0.03); padding:6px 8px; border-radius:8px; font-size:13px;}

/* Personalization */
.personalization-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:12px; margin-top:16px;}
.personalization-item{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); padding:12px; border-radius:16px; border:1px solid rgba(255,255,255,0.03);}
.apply-btn{background:var(--accent-2); color:#111; padding:6px 12px; border-radius:6px; font-size:12px; font-weight:700; cursor:pointer; border:none;}

/* Game inventory - smaller and scrollable */
.game-inv-panel {
  background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
  border-radius: 16px;
  padding: 8px;
  border: 1px solid rgba(255,255,255,0.03);
  width: 100%;
  max-height: calc(100vh - 120px);
  overflow-y: auto;
}
.game-inv-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 6px;
  padding: 4px;
  background: rgba(255,255,255,0.02);
  border-radius: 6px;
  font-size: 11px;
}
.use-btn {
  background: var(--accent-2);
  color: #111;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 10px;
  font-weight: 700;
  cursor: pointer;
  border: none;
}

/* Casino */
.casino-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; margin-top: 16px; }
.casino-item { background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent); padding: 16px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.03); text-align: center; }
.color-choice { display: flex; gap: 10px; justify-content: center; margin: 10px 0; }
.color-btn { width: 50px; height: 50px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.1); cursor: pointer; font-size: 24px; }
.color-btn.selected { border-color: var(--accent); box-shadow: 0 0 10px var(--accent-2); }
#rouletteSpinner { font-size: 48px; text-align: center; margin: 20px 0; }
#countdown { font-size: 36px; font-weight: 700; text-align: center; margin: 20px 0; color: var(--accent-2); }

/* Exchange */
.exchange-panel { display: flex; flex-direction: column; gap: 16px; max-width: 400px; margin: 0 auto; }
.exchange-form { background: rgba(255,255,255,0.02); padding: 16px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.03); }
.exchange-input { padding: 8px; border-radius: 6px; background: transparent; border: 1px solid rgba(255,255,255,0.04); color: #fff; width: 100%; margin-bottom: 8px; }
.exchange-result { font-weight: 700; color: var(--accent-2); text-align: center; padding: 8px; background: rgba(255,255,255,0.01); border-radius: 6px; }
.exchange-error { color: #ff6b6b; font-size: 12px; text-align: center; margin-top: 4px; }

/* Slots */
#screenSlots { background: var(--bg-bottom); flex-direction: column; align-items: center; justify-content: center; height: 100vh; padding: 20px; }
#slotContent { display: flex; flex-direction: column; align-items: center; justify-content: center; flex: 1; width: 100%; }
.slot-reel { font-size: 80px; width: 100px; height: 100px; border: 2px solid var(--accent); border-radius: 12px; display: flex; align-items: center; justify-content: center; background: var(--glass); margin: 0 10px; }
.lever-btn { background: #ff0000; color: white; padding: 20px 40px; border-radius: 50px; font-size: 24px; font-weight: 700; cursor: pointer; border: none; box-shadow: 0 10px 20px rgba(0,0,0,0.5); transition: transform 0.2s; }
.lever-btn:active { transform: scale(0.95); }
#slotResult { margin-top: 40px; font-size: 24px; color: var(--accent-2); text-align: center; }

/* Horse race */
#screenHorseRace { background: var(--bg-bottom); flex-direction: column; align-items: center; justify-content: center; height: 100vh; padding: 20px; display: none; }
#horseContent { display: flex; flex-direction: column; align-items: center; justify-content: center; flex: 1; width: 100%; }
.race-track { display: flex; flex-direction: column; gap: 10px; width: 100%; max-width: 600px; }
.track-lane { 
  display: flex; height: 60px; background: rgba(255,255,255,0.05); border-radius: 8px; position: relative; overflow: hidden; 
  align-items: center; justify-content: space-between; padding: 0 10px;
}
.horse { position: absolute; left: 0; top: 50%; transform: translateY(-50%); font-size: 32px; transition: left 0.1s linear; z-index: 2; }
.horse.boost::after { content: 'üí®'; position: absolute; right: -20px; top: 50%; transform: translateY(-50%); animation: boost 1s ease-out; }
@keyframes boost { 0% { opacity: 1; transform: translateY(-50%) translateX(0); } 100% { opacity: 0; transform: translateY(-50%) translateX(-50px); } }
.progress-bar { height: 4px; background: var(--accent-2); border-radius: 2px; transition: width 0.1s linear; width: 0%; }
.finish-line { position: absolute; right: 0; top: 0; height: 100%; width: 4px; background: var(--accent-2); z-index: 1; }
#raceTimer { font-size: 24px; color: var(--accent-2); margin: 20px 0; }
#raceResult { margin-top: 20px; font-size: 24px; color: var(--accent-2); text-align: center; }
.bet-form { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
.bet-input { padding: 8px; border-radius: 6px; background: transparent; border: 1px solid rgba(255,255,255,0.04); color: #fff; }
.horse-btn { background: var(--accent); color: #111; padding: 8px 16px; border-radius: 6px; font-weight: 700; cursor: pointer; border: none; margin: 2px; }
.start-race-btn { background: var(--accent-2); color: #111; padding: 12px 24px; border-radius: 12px; font-size: 18px; font-weight: 700; cursor: pointer; border: none; }

/* Trump card */
.trump { display: inline-flex; align-items: center; justify-content: center; width: 50px; height: 50px; background: white; border-radius: 50%; border: 2px solid gold; color: black; font-size: 28px; font-weight: bold; box-shadow: 0 4px 8px rgba(0,0,0,0.3); }

/* Animations */
@keyframes flash { 0%, 100% { filter: brightness(1); } 50% { filter: brightness(2); } }
@keyframes fall { to { top: 0vh; opacity: 0; transform: rotate(360deg); } }

/* Modal: hidden (replaced by toast) */
#modal { display: none !important; }
#modalContent { display:none; }
#modalClose { display:none; }

/* Toast (non-blocking notifications) */
#toast{ position:fixed; left:8px; right:8px; bottom: calc(var(--bottom-bar-height) + 8px); z-index:1000; display:none; }
.toast-msg{ background: rgba(0,0,0,0.78); color: var(--accent); padding:10px 12px; border-radius:12px; text-align:center; border:1px solid rgba(255,255,255,0.1); box-shadow: var(--shadow-strong); }

/* Screens */
.screen { display: none; flex:1; overflow-y: auto; min-height: calc(var(--app-height) - var(--bottom-bar-height)); } 
.screen.active { display: flex; flex-direction: column; }

/* Game screen allows scroll if needed */
#screenGame { overflow-y: auto; }

/* Fixed HUD */
.hud-fixed{ position: fixed; top: 8px; right: 8px; z-index: 5; background: rgba(0,0,0,0.15); border-radius: 12px; padding: 6px 8px; backdrop-filter: blur(6px); }

/* Controls no longer fixed */
.controls-fixed { display: none; }

@media(max-width:640px){
  .shelves{grid-template-columns:1fr;}
  .table { flex-direction: column; }
  #log { max-height: 60px; font-size: 11px; padding: 6px; }
  .app { gap: 12px; }
  #nickProfile { width: 100% !important; }
  .card-panel { overflow-y: auto; max-height: calc(100vh - 200px); }
  #screenProfile .card-panel { 
    max-height: calc(100vh - 250px); 
    margin-top: 12px;
    padding: 12px;
  }
  .title-wrap { padding-top: 8px; }
}

/* Fit whole field on shorter heights */
@media (max-height:730px){
  :root{ --card-w:60px; --card-h:84px; --log-h:110px; }
  .table{ gap:8px; padding:10px; }
  .title-wrap{ padding-top:4px; }
  .table-center{ gap:8px; }
  .table-slot{ min-width:120px; min-height:88px; padding:8px; }
  .avatar.large{ width:72px; height:72px; font-size:30px; }
}

/* Ultra-compact for very short viewports */
@media (max-height:660px){
  :root{ --card-w:56px; --card-h:78px; --log-h:96px; }
  .player-chip{ padding:4px; }
  .avatar.small{ width:36px; height:36px; font-size:16px; }
  .avatar.medium{ width:42px; height:42px; font-size:18px; }
}

.version { position: fixed; bottom: calc(var(--bottom-bar-height) + 8px); right: 8px; font-size: 11px; color: var(--muted); font-family: monospace; }

</style>
</head>
<body>
<div class="app">

  <!-- INTRO -->
  <div id="screenIntro" class="screen active">
    <div class="title-wrap">
      <div class="logo-card">üÉè</div>
      <div>
        <div class="title">–õ–µ—á–æ. –ê—Ö—É–µ–≤—à–∞—è –∑–∞—Ä—É–±–∞ –≤ –¢–µ—Ö–∞—Å–µ.</div>
        <div class="subtitle">–ì—Ä—É–±–∞—è –∫–∞—Ä—Ç–æ—á–Ω–∞—è –Ω–µ—Ä–≤–æ—Ç—Ä—ë–ø–∫–∞, —Å–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ-—Å—Ç–∞—Ä–∏–Ω–∫–µ</div>
      </div>
    </div>
    <div class="shelves">
      <div class="shelf card-panel" id="shelfMenu">
        <h3>–ú–µ–Ω—é</h3>
        <p>–ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã, –≤—ã–±–æ—Ä —Ä–∞–∑–º–µ—Ä–∞ –∫–æ–º–Ω–∞—Ç—ã –∏ –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º.</p>
        <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
          <select id="lobbySize"><option>3</option><option>4</option><option>5</option></select>
          <div class="big-btn" id="startFromIntro">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</div>
          <div class="big-btn" id="btnLechoBetting" style="opacity:0.5;cursor:not-allowed;" title="–û—Ç–∫—Ä–æ–µ—Ç—Å—è –ø–æ—Å–ª–µ 3 –ø–æ–±–µ–¥">üé∞ –õ–µ—á–æ –Ω–∞ —Å—Ç–∞–≤–∫—É <span id="winsProgress">(0/3)</span></div>
          <div class="big-btn" id="btnExchange">–û–±–º–µ–Ω –≤–∞–ª—é—Ç—ã</div>
          <div class="big-btn" id="btnCasino">–ê–∑–∞—Ä—Ç–Ω—ã–µ –∏–≥—Ä—ã</div>
          <div class="big-btn" id="btnRules">–ü—Ä–∞–≤–∏–ª–∞</div>
        </div>
      </div>
    </div>
  </div>

  <!-- EXCHANGE -->
  <div id="screenExchange" class="screen">
    <div class="title-wrap">
      <div class="logo-card">üÉè</div>
      <div class="title">–û–±–º–µ–Ω –≤–∞–ª—é—Ç—ã</div>
    </div>
    <div class="card-panel">
      <p class="small-muted">–†–∞–∑–º–µ–Ω—è–π—Ç–µ üíé –Ω–∞ ü™ô –∏ –æ–±—Ä–∞—Ç–Ω–æ –ø–æ —Ç–µ–∫—É—â–µ–º—É –∫—É—Ä—Å—É.</p>
      <div class="exchange-panel">
        <div class="exchange-form">
          <h4>üíé ‚Üí ü™ô (3üíé = 1ü™ô, –∫—Ä–∞—Ç–Ω–æ 3)</h4>
          <input id="diamondsToCoinsInput" type="number" min="3" step="3" class="exchange-input" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ üíé (–∫—Ä–∞—Ç–Ω–æ 3)">
          <div id="diamondsToCoinsResult" class="exchange-result">ü™ô 0</div>
          <div id="diamondsToCoinsError" class="exchange-error" style="display:none;"></div>
          <div class="big-btn" id="confirmDiamondsToCoins">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–¥–µ–ª–∫—É</div>
        </div>
        <div class="exchange-form">
          <h4>ü™ô ‚Üí üíé (1ü™ô = 2üíé, –ª—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)</h4>
          <input id="coinsToDiamondsInput" type="number" min="1" class="exchange-input" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ ü™ô">
          <div id="coinsToDiamondsResult" class="exchange-result">üíé 0</div>
          <div class="big-btn" id="confirmCoinsToDiamonds">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–¥–µ–ª–∫—É</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <div class="big-btn" id="backFromExchange">–ù–∞–∑–∞–¥</div>
      </div>
    </div>
  </div>

  <!-- CASINO -->
  <div id="screenCasino" class="screen">
    <div class="title-wrap">
      <div class="logo-card">üÉè</div>
      <div class="title">–ê–∑–∞—Ä—Ç–Ω—ã–µ –∏–≥—Ä—ã</div>
    </div>
    <div class="card-panel">
      <p class="small-muted">–†–∏—Å–∫—É–π—Ç–µ –≤–∞–ª—é—Ç–æ–π –≤ –º–∏–Ω–∏-–∏–≥—Ä–∞—Ö –∫–∞–∑–∏–Ω–æ.</p>
      <div class="casino-grid">
        <div class="casino-item">
          <h4>–†—É—Å—Å–∫–∞—è —Ä—É–ª–µ—Ç–∫–∞</h4>
          <p>–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å: –õ–µ–≥–∫–æ (–≤—ã–∏–≥—Ä—ã—à x1.67, 5 –ø—É—Å—Ç—ã—Ö/1 –∑–∞—Ä—è–∂–µ–Ω–Ω—ã–π) –∏–ª–∏ –°–ª–æ–∂–Ω–æ (–≤—ã–∏–≥—Ä—ã—à x5, 1 –ø—É—Å—Ç–æ–π/5 –∑–∞—Ä—è–∂–µ–Ω–Ω—ã—Ö).</p>
          <input id="rouletteBet" type="number" min="1" class="bet-input" placeholder="–°—Ç–∞–≤–∫–∞ üíé (–º–∏–Ω. 1)">
          <select id="rouletteDifficulty"><option value="easy">–õ–µ–≥–∫–æ</option><option value="hard">–°–ª–æ–∂–Ω–æ</option></select>
          <div class="big-btn" id="startRoulette">–ò–≥—Ä–∞—Ç—å</div>
          <div id="rouletteResult"></div>
          <div id="countdown"></div>
        </div>
        <div class="casino-item">
          <h4>–†–∞–∑–Ω–æ—Ü–≤–µ—Ç–Ω–∞—è —Ä—É–ª–µ—Ç–∫–∞</h4>
          <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç: üî¥ (45%, –≤—ã–∏–≥—Ä—ã—à x2), ‚ö´Ô∏è (45%, –≤—ã–∏–≥—Ä—ã—à x2), üü¢ (10%, –≤—ã–∏–≥—Ä—ã—à x50).</p>
          <input id="colorBet" type="number" min="1" class="bet-input" placeholder="–°—Ç–∞–≤–∫–∞ üíé (–º–∏–Ω. 1)">
          <div class="color-choice">
            <button class="color-btn" data-color="üî¥" id="colorRed">üî¥</button>
            <button class="color-btn" data-color="‚ö´Ô∏è" id="colorBlack">‚ö´Ô∏è</button>
            <button class="color-btn" data-color="üü¢" id="colorGreen">üü¢</button>
          </div>
          <div class="big-btn" id="confirmColorChoice" style="display:none;">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä</div>
          <div id="rouletteSpinner"></div>
          <div id="colorResult"></div>
        </div>
        <div class="casino-item">
          <h4>–ó–æ–ª–æ—Ç–∞—è –ª–∏—Ö–æ—Ä–∞–¥–∫–∞</h4>
          <p>–ù–∞–∂–º–∏—Ç–µ "–ü–æ–≤–µ–∑–µ—Ç" –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (7% —à–∞–Ω—Å –Ω–∞ –¥–∂–µ–∫–ø–æ—Ç x155).</p>
          <input id="goldBet" type="number" min="1" class="bet-input" placeholder="–°—Ç–∞–≤–∫–∞ ü™ô (–º–∏–Ω. 1)">
          <div class="big-btn" id="luckyBtn">–ü–æ–≤–µ–∑–µ—Ç</div>
          <div class="big-btn" id="confirmGoldRush" style="display:none;">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏–≥—Ä—É</div>
          <div id="goldRushResult"></div>
        </div>
        <div class="casino-item">
          <h4>–°–ª–æ—Ç-–º–∞—à–∏–Ω–∫–∞</h4>
          <p>–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫, —â–µ–¥—Ä—ã–µ –≤—ã–ø–ª–∞—Ç—ã. –¢—è–Ω–∏—Ç–µ —Ä—ã—á–∞–≥!</p>
          <input id="slotsBet" type="number" min="1" class="bet-input" placeholder="–°—Ç–∞–≤–∫–∞ üíé (–º–∏–Ω. 1)">
          <div class="big-btn" id="btnSlots">üé∞ –ò–≥—Ä–∞—Ç—å –≤ —Å–ª–æ—Ç—ã</div>
        </div>
        <div class="casino-item" style="opacity:0.5; cursor:not-allowed;">
          <h4>–°—Ç–∞–≤–∫–∞ –Ω–∞ –ª–æ—à–∞–¥–∫—É (–Ω–∞ —Ä–µ–º–æ–Ω—Ç–µ)</h4>
          <p>–í—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</p>
          <div class="big-btn" style="background:gray; cursor:not-allowed;" onclick="showModal('–ó–∞–±–µ–≥ –ª–æ—à–∞–¥–µ–π –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')">üöß –ù–∞ —Ä–µ–º–æ–Ω—Ç–µ</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <div class="big-btn" id="backFromCasino">–ù–∞–∑–∞–¥</div>
      </div>
    </div>
  </div>

  <!-- HORSE RACE -->
  <div id="screenHorseRace" class="screen">
    <div class="title-wrap">
      <div class="logo-card">üÉè</div>
      <div class="title">–°—Ç–∞–≤–∫–∞ –Ω–∞ –ª–æ—à–∞–¥–∫—É</div>
    </div>
    <div id="horseContent">
      <div class="bet-form">
        <input id="betAmount" type="number" min="1" class="bet-input" placeholder="–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏ ü™ô (–º–∏–Ω. 1)">
        <div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
          <button class="horse-btn" data-horse="1">–õ–æ—à–∞–¥—å 1 (x1.5)</button>
          <button class="horse-btn" data-horse="2">–õ–æ—à–∞–¥—å 2 (x2.0)</button>
          <button class="horse-btn" data-horse="3">–õ–æ—à–∞–¥—å 3 (x3.0)</button>
          <button class="horse-btn" data-horse="4">–õ–æ—à–∞–¥—å 4 (x5.0)</button>
          <button class="horse-btn" data-horse="5">–õ–æ—à–∞–¥—å 5 (x8.0)</button>
        </div>
        <button id="startRaceBtn" class="start-race-btn" style="display:none;">–ù–∞—á–∞—Ç—å –∑–∞–±–µ–≥!</button>
      </div>
      <div id="raceTrack" class="race-track" style="display:none;">
        <div class="track-lane" data-lane="1">
          <span style="font-size:14px;color:var(--muted);">–õ–æ—à–∞–¥—å 1</span>
          <div class="horse" data-horse="1">üêé</div>
          <div class="progress-bar" data-horse="1"></div>
          <div class="finish-line"></div>
        </div>
        <div class="track-lane" data-lane="2">
          <span style="font-size:14px;color:var(--muted);">–õ–æ—à–∞–¥—å 2</span>
          <div class="horse" data-horse="2">üêé</div>
          <div class="progress-bar" data-horse="2"></div>
          <div class="finish-line"></div>
        </div>
        <div class="track-lane" data-lane="3">
          <span style="font-size:14px;color:var(--muted);">–õ–æ—à–∞–¥—å 3</span>
          <div class="horse" data-horse="3">üêé</div>
          <div class="progress-bar" data-horse="3"></div>
          <div class="finish-line"></div>
        </div>
        <div class="track-lane" data-lane="4">
          <span style="font-size:14px;color:var(--muted);">–õ–æ—à–∞–¥—å 4</span>
          <div class="horse" data-horse="4">üêé</div>
          <div class="progress-bar" data-horse="4"></div>
          <div class="finish-line"></div>
        </div>
        <div class="track-lane" data-lane="5">
          <span style="font-size:14px;color:var(--muted);">–õ–æ—à–∞–¥—å 5</span>
          <div class="horse" data-horse="5">üêé</div>
          <div class="progress-bar" data-horse="5"></div>
          <div class="finish-line"></div>
        </div>
      </div>
      <div id="raceTimer"></div>
      <div id="raceResult"></div>
    </div>
    <div class="big-btn" id="backFromHorseRace">–ù–∞–∑–∞–¥</div>
  </div>

  <!-- SLOTS -->
  <div id="screenSlots" class="screen">
    <div class="title-wrap">
      <div class="logo-card">üÉè</div>
      <div class="title">–°–ª–æ—Ç-–º–∞—à–∏–Ω–∫–∞</div>
    </div>
    <div id="slotContent">
      <div id="slotReels" style="display: flex; gap: 20px; margin-bottom: 40px;">
        <div id="reel1" class="slot-reel"></div>
        <div id="reel2" class="slot-reel"></div>
        <div id="reel3" class="slot-reel"></div>
      </div>
      <div style="margin-bottom: 40px;">
        <div class="balance" style="font-size: 20px;">üíé <span id="slotBalance">0</span></div>
      </div>
      <button id="leverBtn" class="lever-btn">üöÄ –¢—è–Ω—É—Ç—å</button>
      <div id="slotResult"></div>
    </div>
    <div class="big-btn" id="backFromSlots">–ù–∞–∑–∞–¥</div>
  </div>

  <!-- PROFILE -->
  <div id="screenProfile" class="screen">
    <div class="title-wrap">
      <div class="logo-card">üÉè</div>
      <div class="title">–ü—Ä–æ—Ñ–∏–ª—å</div>
    </div>
    <div class="card-panel" style="max-height: calc(100vh - 200px); overflow-y: auto; margin-top: 8px;">
      <div style="display:flex;gap:8px;align-items:flex-start">
        <div id="profileAvatar" class="avatar medium">üë§</div>
        <div style="flex:1; min-width: 0;">
          <div style="display:flex;gap:4px;align-items:center;flex-wrap:wrap;margin-bottom:8px">
            <input id="nickProfile" type="text" placeholder="–ó–ª–æ–π–ö–æ–∑—ë–ª_42" style="padding:6px;border-radius:6px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:#fff;flex:1;min-width:120px;font-size:12px">
            <div class="big-btn" id="saveNick" style="padding:4px 8px;font-size:10px" data-translate="save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</div>
            <div class="big-btn" id="backFromProfile" style="padding:4px 8px;font-size:10px" data-translate="back">–ù–∞–∑–∞–¥</div>
          </div>
          <div id="goldRushBadge" style="display:none;background:linear-gradient(to right, gold, yellow);color:black;padding:2px 6px;border-radius:4px;font-size:10px;font-weight:700;margin-bottom:8px;text-align:center;">üèÜ –ü–æ–∫–æ—Ä–∏—Ç–µ–ª—å –ª–∏—Ö–æ—Ä–∞–¥–∫–∏</div>
          
          <div style="margin-bottom:8px">
            <div class="small-muted" style="font-size:11px;margin-bottom:4px" data-translate="avatar">–ê–≤–∞—Ç–∞—Ä:</div>
            <input id="avatarInput" type="file" accept="image/*" style="color:#fff;font-size:10px;margin-bottom:4px">
            <select id="avatarSelect" style="padding:4px;border-radius:4px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:#fff;width:100%;font-size:10px;margin-bottom:4px;"></select>
            <div class="big-btn" id="applyAvatar" style="width:100%;padding:4px;font-size:10px" data-translate="applyAvatar">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</div>
          </div>
          
          <div style="margin-bottom:8px">
            <div style="display:flex;gap:4px;align-items:center;flex-wrap:wrap">
              <label class="small-muted" style="font-size:11px">–°—Ç–∞—Ç—É—Å:</label>
              <select id="statusSelect" style="padding:4px;border-radius:4px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:#fff;font-size:10px;flex:1;min-width:120px">
                <option value="none" data-translate="noStatus">–ë–µ–∑ —Å—Ç–∞—Ç—É—Å–∞</option>
                <option value="conqueror" data-translate="conqueror">–ü–æ–∫–æ—Ä–∏—Ç–µ–ª—å –ª–∏—Ö–æ—Ä–∞–¥–∫–∏</option>
              </select>
              <div class="big-btn" id="saveStatus" style="padding:4px 8px;font-size:10px">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</div>
            </div>
          </div>
          
          <div style="margin-bottom:8px">
            <div class="small-muted" style="font-size:11px" data-translate="balance">–ë–∞–ª–∞–Ω—Å: <span id="balText">ü™ô0 üíé0</span></div>
            <div class="small-muted" style="font-size:11px;margin-top:4px" data-translate="inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å:</div>
            <div id="inventory" class="inv" style="max-height:80px;overflow-y:auto;font-size:10px"></div>
          </div>
          
          <div style="margin-bottom:8px">
            <div class="small-muted" style="font-size:11px;margin-bottom:4px" data-translate="language">–Ø–∑—ã–∫:</div>
            <select id="languageSelect" style="padding:4px;border-radius:4px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:#fff;width:100%;font-size:10px;">
              <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
              <option value="es">üá™üá∏ Espa√±ol</option>
              <option value="en">üá¨üáß English</option>
              <option value="fr">üá´üá∑ Fran√ßais</option>
              <option value="de">üá©üá™ Deutsch</option>
            </select>
          </div>
          
          <div>
            <h4 class="small-muted" style="font-size:12px;margin-bottom:4px" data-translate="personalization">–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è</h4>
            <div class="personalization-grid" id="personalizationGrid" style="grid-template-columns:1fr;gap:4px"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SHOP -->
  <div id="screenShop" class="screen">
    <div class="title-wrap">
      <div class="logo-card">üÉè</div>
      <div class="title">–ú–∞–≥–∞–∑–∏–Ω</div>
    </div>
    <div class="card-panel">
      <p class="small-muted">–ù–∏–∂–µ ‚Äî –≤–∏—Ç—Ä–∏–Ω–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏ —É—Å–ª—É–≥. –Ø –ø—Ä–∏–¥—É–º—ã–≤–∞–ª –∏—Ö —Ç–∞–∫, —á—Ç–æ–±—ã –º–æ–Ω–µ—Ç–∫–∞ –¥–∞–≤–∞–ª–∞ –æ—â—É—Ç–∏–º—É—é –º–µ–ª–∫—É—é –≤—ã–≥–æ–¥—É.</p>
      <div class="shop-grid" id="shopGrid">
        <!-- items rendered by JS -->
      </div>
      <div style="margin-top:12px;display:flex;gap:8px">
        <div class="big-btn" id="backFromShop">–ù–∞–∑–∞–¥</div>
      </div>
    </div>
  </div>

  <!-- RULES -->
  <div id="screenRules" class="screen">
    <div class="title-wrap">
      <div class="logo-card">üÉè</div>
      <div class="title" data-translate="rulesTitle">–ü—Ä–∞–≤–∏–ª–∞</div>
    </div>
    <div class="card-panel">
      <div style="max-height:340px;overflow:auto;padding-right:6px">
        <p class="small-muted" data-translate="rulesIntro">–ò–≥—Ä–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è ¬´–õ–µ—á–æ¬ª.</p>
        <p class="small-muted" data-translate="rulesCards">–í –∏–≥—Ä–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è 4 –º–∞—Å—Ç–∏, –∫–∞–∫ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–Ω—ã—Ö –∏–≥—Ä–∞—Ö: ‚ô£Ô∏è‚ô†Ô∏è‚ô•Ô∏è‚ô¶Ô∏è. –ö–æ–ª–æ–¥–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 36 –∫–∞—Ä—Ç.</p>
        <p class="small-muted" data-translate="rulesDeal">–ö–∞–∂–¥–æ–º—É –∏–≥—Ä–æ–∫—É —Ä–∞–∑–¥–∞–µ—Ç—Å—è –ø–æ 3 —Å–ª—É—á–∞–π–Ω—ã–µ –∫–∞—Ä—Ç—ã –∏–∑ –∫–æ–ª–æ–¥—ã. –°–∞–º–∞—è –Ω–∏–∂–Ω—è—è –∫–∞—Ä—Ç–∞ –≤ –∫–æ–ª–æ–¥–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–∑—ã—Ä—å –Ω–∞ –ø–∞—Ä—Ç–∏—é.</p>
        <p class="small-muted" data-translate="rulesStart">–ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ä–∞–∑–¥–∞—á–∏. –ò–≥—Ä–æ–∫–∏ –º–æ–≥—É—Ç —Ö–æ–¥–∏—Ç—å (–∞—Ç–∞–∫–æ–≤–∞—Ç—å) –∏–ª–∏ –æ—Ç–±–∏–≤–∞—Ç—å—Å—è –∫–∞—Ä—Ç–∞–º–∏. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–∞—Ä—Ç—ã –¥–æ –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã –∑–∞–ø—Ä–µ—â–µ–Ω–æ. –ù–µ—Ç –¥—Ä—É–≥–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ö–æ–¥–∞. –ü–µ—Ä–≤—ã–π —Ö–æ–¥ –¥–µ–ª–∞–µ—Ç –∏–≥—Ä–æ–∫ —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º –∫–æ–∑—ã—Ä–µ–º, –¥–∞–ª–µ–µ –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ.</p>
        <p class="small-muted" data-translate="rulesAttack">–ê—Ç–∞–∫—É—é—â–∏–π –∏–≥—Ä–æ–∫ –º–æ–∂–µ—Ç —Å–≤–∞–π–ø–æ–º –≤—ã–∫–∏–Ω—É—Ç—å –Ω–µ–Ω—É–∂–Ω—É—é –∫–∞—Ä—Ç—É, —á—Ç–æ–±—ã –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è —Å–æ–±—Ä–∞—Ç—å –∫–æ–º–±–∏–Ω–∞—Ü–∏—é, –≤–∑—è–≤ –Ω–æ–≤—É—é –∏–∑ –∫–æ–ª–æ–¥—ã. –ï—Å–ª–∏ –æ–±–æ—Ä–æ–Ω—è—é—â–∏–π—Å—è –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–±–∏—Ç—å –∞—Ç–∞–∫—É—é—â—É—é –∫–∞—Ä—Ç—É, –æ–Ω –∑–∞–±–∏—Ä–∞–µ—Ç –µ—ë —Å–µ–±–µ. –ï—Å–ª–∏ –∞—Ç–∞–∫–∞ –æ—Ç–±–∏—Ç–∞, –æ–±–µ –∫–∞—Ä—Ç—ã (–∞—Ç–∞–∫–∞ –∏ –æ—Ç–±–æ–π) –ø–µ—Ä–µ–º–µ—à–∏–≤–∞—é—Ç—Å—è –∏ –∫–ª–∞–¥—É—Ç—Å—è –≤ –∫–æ–ª–æ–¥—É –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –≤—ã—Ç—è–≥–∏–≤–∞–Ω–∏—è.</p>
        <p class="small-muted" data-translate="rulesCombos">–ö–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è —Å—Ç—Ä–æ–≥–æ –∏–∑ 3 –∫–∞—Ä—Ç. –í—Å–µ–≥–æ 3 —Ç–∏–ø–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π:</p>
        <ol class="small-muted">
          <li data-translate="rulesRepeat">–ü–æ–≤—Ç–æ—Ä: 3 –∫–∞—Ä—Ç—ã –æ–¥–Ω–æ–≥–æ –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 6‚ô£Ô∏è, 6‚ô†Ô∏è, 6‚ô•Ô∏è).</li>
          <li data-translate="rulesSequence">–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 3 –∫–∞—Ä—Ç—ã –ø–æ–¥—Ä—è–¥ –ø–æ –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤—É, –æ—Ç –º–µ–Ω—å—à–µ–≥–æ –∫ –±–æ–ª—å—à–µ–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, J‚ô•Ô∏è, Q‚ô†Ô∏è, K‚ô£Ô∏è –∏–ª–∏ 6‚ô†Ô∏è, 7‚ô£Ô∏è, 8‚ô•Ô∏è).</li>
          <li data-translate="rulesSuit">–ú–∞—Å—Ç—å: 3 –∫–∞—Ä—Ç—ã –æ–¥–Ω–æ–π –º–∞—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 7‚ô•Ô∏è, Q‚ô•Ô∏è, A‚ô•Ô∏è –∏–ª–∏ 6‚ô£Ô∏è, 7‚ô£Ô∏è, 9‚ô£Ô∏è).</li>
        </ol>
        <p class="small-muted" data-translate="rulesLecho">–ï—Å–ª–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è —Å–æ–±—Ä–∞–Ω–∞, –Ω–æ –∏–≥—Ä–æ–∫ –Ω–µ –Ω–∞–∂–∞–ª ¬´–õ–µ—á–æ¬ª, –∏–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è ‚Äî —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –∏–≥—Ä–æ–∫–∞. –ï—Å–ª–∏ –Ω–∞–∂–∞—Ç—å ¬´–õ–µ—á–æ¬ª –±–µ–∑ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏, –ø–æ—è–≤–∏—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: ¬´–í—ã –Ω–µ —Å–æ–±—Ä–∞–ª–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é!¬ª. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ ¬´–õ–µ—á–æ¬ª –∏–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç 1 ü™ô –∏ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É ‚Äî –æ–∂–∏–¥–∞—Ç—å –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã.</p>
        <p class="small-muted" data-translate="rulesEnd">–ò–≥—Ä–∞ –¥–ª–∏—Ç—Å—è, –ø–æ–∫–∞ –Ω–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ–¥–∏–Ω –∏–≥—Ä–æ–∫ –±–µ–∑ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∏–ª–∏ –Ω–µ –æ–±—ä—è–≤–∏–≤—à–∏–π ¬´–õ–µ—á–æ¬ª timely.</p>
        <p class="small-muted" data-translate="rulesGuess">–í –∫–æ–Ω—Ü–µ –∏–≥—Ä—ã –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏–π —É–≥–∞–¥—ã–≤–∞–µ—Ç –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –ø–æ –ø–æ–¥—Å–∫–∞–∑–∫–µ (—Ç–∏–ø –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏: –ø–æ–≤—Ç–æ—Ä, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–ª–∏ –º–∞—Å—Ç—å). –û–±–º–∞–Ω –∑–∞–ø—Ä–µ—â–µ–Ω. –ó–∞ –∫–∞–∂–¥—É—é —É–≥–∞–¥–∞–Ω–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –¥–∞–µ—Ç—Å—è 1 üíé.</p>
        <p class="small-muted" data-translate="rulesPenalty">–ó–∞ –∫–∞–∂–¥—É—é –Ω–µ—É–≥–∞–¥–∞–Ω–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –∏–∑ –Ω–æ–≤–æ–π –∫–æ–ª–æ–¥—ã –≤—ã—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è 3 –∫–∞—Ä—Ç—ã. –ï—Å–ª–∏ –≤ –Ω–∏—Ö –µ—Å—Ç—å –∫–æ–º–±–∏–Ω–∞—Ü–∏—è, –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –µ—â–µ 3. –ï—Å–ª–∏ –≤—ã—Ç—è–Ω—É—Ç–æ –±–æ–ª—å—à–µ 15 –∫–∞—Ä—Ç, —ç—Ç–æ ¬´–∫–æ–ª–æ–¥–∞¬ª ‚Äî –∏–≥—Ä–æ–∫ –ø—Ä–æ–∏–≥—Ä–∞–ª –¥–≤–∞–∂–¥—ã.</p>
        <h4 class="small-muted">–û–±–º–µ–Ω –≤–∞–ª—é—Ç—ã</h4>
        <p class="small-muted">üíé ‚Üí ü™ô: 3üíé = 1ü™ô (–∫—Ä–∞—Ç–Ω–æ 3). ü™ô ‚Üí üíé: 1ü™ô = 2üíé (–ª—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ). –ê–≤—Ç–æ–ø–æ–¥—Å—á–µ—Ç –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏.</p>
        <h4 class="small-muted">–ê–∑–∞—Ä—Ç–Ω—ã–µ –∏–≥—Ä—ã</h4>
        <p class="small-muted">1. –†—É—Å—Å–∫–∞—è —Ä—É–ª–µ—Ç–∫–∞ (1üíé): –í—ã–±–æ—Ä —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (–ª–µ–≥–∫–æ: +5üíé; —Å–ª–æ–∂–Ω–æ: +15üíé). –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç –∏ –≤—ã—Å—Ç—Ä–µ–ª (üí•/üí®).</p>
        <p class="small-muted">2. –†–∞–∑–Ω–æ—Ü–≤–µ—Ç–Ω–∞—è —Ä—É–ª–µ—Ç–∫–∞ (1üíé): –í—ã–±–æ—Ä üî¥/‚ö´Ô∏è/üü¢. –®–∞–Ω—Å—ã: 45%/45%/10%. –í—ã–∏–≥—Ä—ã—à–∏: +4üíé/+4üíé/+100üíé. –ê–Ω–∏–º–∞—Ü–∏—è —Å–º–µ–Ω—ã —à–∞—Ä–∏–∫–æ–≤ 3-6 —Å–µ–∫.</p>
        <p class="small-muted">3. –ó–æ–ª–æ—Ç–∞—è –ª–∏—Ö–æ—Ä–∞–¥–∫–∞ (1ü™ô): –ö–Ω–æ–ø–∫–∏ ¬´–ü–æ–≤–µ–∑–µ—Ç¬ª –∏ ¬´–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å¬ª. 7% —à–∞–Ω—Å –Ω–∞ ü™ô777.</p>
        <p class="small-muted">4. –°–ª–æ—Ç-–º–∞—à–∏–Ω–∫–∞ (1üíé): 3 –±–∞—Ä–∞–±–∞–Ω–∞, —Å–∏–º–≤–æ–ª—ã: —Ñ—Ä—É–∫—Ç—ã, üîî, üíé, ‚≠êÔ∏è, üíÄ. –í—ã–ø–ª–∞—Ç—ã: 3üíé +50x —Å—Ç–∞–≤–∫–∞, 3‚≠êÔ∏è +25x —Å—Ç–∞–≤–∫–∞, 3üîî +15x —Å—Ç–∞–≤–∫–∞, 2üíé +8x —Å—Ç–∞–≤–∫–∞, 2‚≠êÔ∏è +5x —Å—Ç–∞–≤–∫–∞, 2üîî +3x —Å—Ç–∞–≤–∫–∞, 3 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Ñ—Ä—É–∫—Ç–∞ +2x —Å—Ç–∞–≤–∫–∞, 2 —Ñ—Ä—É–∫—Ç–∞ +1.2x —Å—Ç–∞–≤–∫–∞, üíÄ –ø—Ä–æ–∏–≥—Ä—ã—à.</p>
        <p class="small-muted">5. –°—Ç–∞–≤–∫–∞ –Ω–∞ –ª–æ—à–∞–¥–∫—É (–Ω–∞ —Ä–µ–º–æ–Ω—Ç–µ): –í—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ.</p>
        <p class="small-muted">6. –õ–µ—á–æ –Ω–∞ —Å—Ç–∞–≤–∫—É (–æ—Ç 3ü™ô): –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ 3 –ø–æ–±–µ–¥ –≤ –æ–±—ã—á–Ω–æ–π –∏–≥—Ä–µ. –°—Ç–∞–≤–∫–∞ –æ—Ç 3ü™ô, –≤—ã–∏–≥—Ä—ã—à x2.5. –ü—Ä–∏ –ø–æ–±–µ–¥–µ –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –æ–±—ã—á–Ω–∞—è –ø–æ–±–µ–¥–∞.</p>
        <p class="small-muted">–ü—Ä–µ–¥–º–µ—Ç—ã –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞ (—Ö–∏–Ω—Ç, –ø–æ–¥–≥–ª—è–¥, –ø—Ä–æ–ø—É—Å–∫ –∏ —Ç.–¥.) –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å –≤ –∏–≥—Ä–µ.</p>
      </div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <div class="big-btn" id="backFromRules">–ù–∞–∑–∞–¥</div>
      </div>
    </div>
  </div>

  <!-- GAME -->
  <div id="screenGame" class="screen">
    <div class="title-wrap">
      <div class="logo-card">üÉè</div>
      <div class="title">–ò–≥—Ä–∞</div>
    </div>
    <div class="table" style="display: grid; gap: 8px; grid-template-columns: 1fr 120px; grid-template-rows: auto auto 1fr auto; align-items: start;">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="players-row" id="playersRow"></div>
        <div id="gameHud" class="hud-fixed" style="display:flex;flex-direction:column;align-items:flex-end;gap:8px">
            <div class="small-muted">–ö–æ–∑—ã—Ä—å</div>
            <span class="trump" id="trumpCard">‚Äî</span>
            <div class="small-muted">–ö–æ–ª–æ–¥–∞: <span id="deckCount">0</span></div>
          </div>
      </div>

      <div class="table-center">
        <div class="table-slot">
          <div class="small-muted">–ê—Ç–∞–∫—É—é—â–∏–π</div>
          <div id="attackerSlot" class="hand"></div>
        </div>
        <div class="table-slot">
          <div class="small-muted">–ó–∞—â–∏—Ç–Ω–∏–∫</div>
          <div id="defenderSlot" class="hand"></div>
        </div>
      </div>

      <div style="display:flex;justify-content:space-between;align-items:flex-start">
        <div style="display:flex;flex-direction:column;gap:4px;flex:1">
          <div class="status" id="turnInfo">–•–æ–¥: ‚Äî</div>
          <div id="actionHint" class="small-muted">–¢–∞–ø–Ω–∏—Ç–µ –∫–∞—Ä—Ç—É –¥–ª—è –∞—Ç–∞–∫–∏/–∑–∞—â–∏—Ç—ã.</div>
          <div style="display:flex;gap:6px" class="controls">
            <div class="big-btn" id="drawBtn">–ë–µ—Ä—É</div>
            <div class="big-btn" id="returnBtn">–í–æ–∑–≤—Ä–∞—Ç ü™ô5</div>
            <div class="big-btn" id="lechoBtn">–õ–µ—á–æ</div>
          </div>
        </div>
      </div>

      <div style="margin-top:4px">
        <div class="small-muted">–í–∞—à–∏ –∫–∞—Ä—Ç—ã:</div>
        <div class="hand" id="playerHand" style="margin-top:4px"></div>
      </div>

      <div class="game-inv-panel" id="gameInvPanel" style="grid-column: 2; grid-row: 1 / span 4; position: sticky; top: 8px; align-self: start;">
        <h4 class="small-muted">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h4>
        <div id="gameInventory"></div>
      </div>
    </div>
  </div>

  <!-- OUTRO -->
  <div id="screenOutro" class="screen">
    <div class="title-wrap">
      <div class="logo-card">üÉè</div>
      <div class="title" id="outroTitle">–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞</div>
    </div>
    <div class="card-panel">
      <div id="outroText"></div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <div class="big-btn" id="playAgain">–ò–≥—Ä–∞—Ç—å –∑–∞–Ω–æ–≤–æ</div>
        <div class="big-btn" id="backFromOutro">–í –º–µ–Ω—é</div>
      </div>
    </div>
  </div>

  <!-- GUESS -->
  <div id="screenGuess" class="screen">
    <div class="title-wrap">
      <div class="logo-card">üÉè</div>
      <div class="title">–£–≥–∞–¥–∞–π—Ç–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏</div>
    </div>
    <div class="card-panel">
      <div id="guessForms"></div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <div class="big-btn" id="submitGuess">–£–≥–∞–¥–∞—Ç—å</div>
        <div class="big-btn" id="backFromGuess">–í –º–µ–Ω—é</div>
      </div>
    </div>
  </div>

  <!-- LECHO BETTING -->
  <div id="screenLechoBetting" class="screen">
    <div class="title-wrap">
      <div class="logo-card">üÉè</div>
      <div class="title">–õ–µ—á–æ –Ω–∞ —Å—Ç–∞–≤–∫—É</div>
    </div>
    <div class="card-panel">
      <p class="small-muted">–ò–≥—Ä–∞–π—Ç–µ –≤ –õ–µ—á–æ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å—Ç–∞–≤–∫–∞–º–∏! –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: 3ü™ô</p>
      <div style="margin:16px 0">
        <div class="small-muted">–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞:</div>
        <input id="lechoBetAmount" type="number" min="3" step="1" class="exchange-input" placeholder="–ú–∏–Ω–∏–º—É–º 3ü™ô" style="margin:8px 0">
        <div class="small-muted">–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à: <span id="lechoPotentialWin">0ü™ô</span></div>
      </div>
      <div style="display:flex;gap:8px;margin:16px 0">
        <div class="big-btn" id="startLechoBetting" style="flex:1">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É –Ω–∞ —Å—Ç–∞–≤–∫—É</div>
        <div class="big-btn" id="backFromLechoBetting">–ù–∞–∑–∞–¥</div>
      </div>
      <div id="lechoBettingResult" style="margin-top:16px;text-align:center;font-weight:700;"></div>
    </div>
  </div>

  <!-- Top Balance Bar -->
  <div class="top-balance-bar">
    <div class="balance" id="balanceDisplay">ü™ô 0 üíé 0</div>
  </div>

  <!-- Bottom Bar -->
  <div class="bottom-bar">
    <div class="nav-buttons">
      <div class="big-btn" id="btnIntro"><span>üè†</span><br>–ì–ª–∞–≤–Ω–∞—è</div>
      <div class="big-btn" id="btnProfile"><span>üë§</span><br>–ü—Ä–æ—Ñ–∏–ª—å</div>
      <div class="big-btn" id="btnShop"><span>üõí</span><br>–ú–∞–≥–∞–∑–∏–Ω</div>
      <div class="big-btn" id="btnNew"><span>üé≤</span><br>–ù–æ–≤–∞—è</div>
    </div>
  </div>

</div>

<!-- Modal -->
<div id="modal" style="display:none">
  <div id="modalContent">
    <div id="modalText"></div>
    <button id="modalClose">OK</button>
  </div>
  <!-- kept for backward compatibility, but hidden by CSS -->
  </div>

<!-- Toast container -->
<div id="toast"><div class="toast-msg" id="toastMsg"></div></div>

<div class="version">MegaSlots update. v2.2</div>

<script>
// === –°–ï–†–í–ï–†–ù–ê–Ø –ß–ê–°–¢–¨ Google Sheets ===
const API_URL = 'https://script.google.com/macros/s/AKfycbypEOFQmpQGlyYYpK-or_Okgj6ejB5zj_63tFgH0n-4BWDa4gJcD7x_G-WNZ6LIRlI/exec';

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
async function savePlayerData(id, nickname, balance, diamonds, wins) {
  try {
    const response = await fetch(API_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ 
        action: 'save',
        id, 
        nickname, 
        balance, 
        diamonds, 
        wins 
      })
    });
    
    if (response.ok) {
      const result = await response.json();
      console.log('–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è ID:', id, result);
    } else {
      console.error('–û—à–∏–±–∫–∞ HTTP:', response.status, response.statusText);
    }
  } catch (e) {
    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä–æ–∫–∞
async function loadPlayerData(id) {
  try {
    const res = await fetch(`${API_URL}?action=load&id=${id}`);
    if (res.ok) {
      const data = await res.json();
      console.log('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–ª—è ID:', id, data);
      return data;
    } else {
      console.error('–û—à–∏–±–∫–∞ HTTP –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:', res.status, res.statusText);
      return null;
    }
  } catch (e) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
    return null;
  }
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID –∏–≥—Ä–æ–∫–∞
function generatePlayerId() {
  const id = 'player_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
  sessionStorage.setItem('lecho_player_id', id);
  return id;
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
async function loadPlayerDataOnInit() {
  const playerId = sessionStorage.getItem('lecho_player_id');
  if (playerId) {
    const data = await loadPlayerData(playerId);
    if (data && data.success) {
      balance = data.balance || 0;
      diamonds = data.diamonds || 0;
      winsCount = data.wins || 0;
      sessionStorage.setItem('lecho_balance', String(balance));
      sessionStorage.setItem('lecho_diamonds', String(diamonds));
      sessionStorage.setItem('lecho_wins', String(winsCount));
      console.log('–î–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å —Å–µ—Ä–≤–µ—Ä–∞:', data);
    }
  } else {
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π ID –¥–ª—è –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
    generatePlayerId();
  }
}

// === –°–ò–°–¢–ï–ú–ê –ü–ï–†–ï–í–û–î–û–í ===
const TRANSLATIONS = {
  ru: {
    // –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    home: '–ì–ª–∞–≤–Ω–∞—è',
    profile: '–ü—Ä–æ—Ñ–∏–ª—å', 
    shop: '–ú–∞–≥–∞–∑–∏–Ω',
    newGame: '–ù–æ–≤–∞—è –∏–≥—Ä–∞',
    rules: '–ü—Ä–∞–≤–∏–ª–∞',
    casino: '–ö–∞–∑–∏–Ω–æ',
    exchange: '–û–±–º–µ–Ω',
    lechoBetting: '–õ–µ—á–æ –Ω–∞ —Å—Ç–∞–≤–∫—É',
    
    // –ò–≥—Ä–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    attack: '–ê—Ç–∞–∫—É–µ—Ç',
    you: '(–í—ã)',
    yourTurn: '–í–∞—à —Ö–æ–¥: —Ç–∞–ø–Ω–∏—Ç–µ –∫–∞—Ä—Ç—É –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–ë–µ—Ä—É".',
    waiting: '–ü–æ–¥–æ–∂–¥–∏—Ç–µ.',
    taking: '–ë–µ—Ä—É',
    return: '–í–µ—Ä–Ω—É—Ç—å',
    lecho: '–õ–µ—á–æ',
    
    // –ö–æ–º–±–∏–Ω–∞—Ü–∏–∏
    repeat: '–ü–æ–≤—Ç–æ—Ä',
    sequence: '–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å', 
    suit: '–ú–∞—Å—Ç—å',
    
    // –°—Ç–∞—Ç—É—Å—ã
    noStatus: '–ë–µ–∑ —Å—Ç–∞—Ç—É—Å–∞',
    conqueror: '–ü–æ–∫–æ—Ä–∏—Ç–µ–ª—å –ª–∏—Ö–æ—Ä–∞–¥–∫–∏',
    
    // –ú–∞–≥–∞–∑–∏–Ω
    buy: '–ö—É–ø–∏—Ç—å',
    use: '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å',
    apply: '–ü—Ä–∏–º–µ–Ω–∏—Ç—å',
    save: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å',
    back: '–ù–∞–∑–∞–¥',
    
    // –ü—Ä–æ—Ñ–∏–ª—å
    language: '–Ø–∑—ã–∫',
    avatar: '–ê–≤–∞—Ç–∞—Ä',
    balance: '–ë–∞–ª–∞–Ω—Å',
    inventory: '–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å',
    personalization: '–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è',
    applyAvatar: '–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä',
    
    // –ú–∞–≥–∞–∑–∏–Ω —Ç–æ–≤–∞—Ä—ã
    themeDark: '–¢–µ–º–∞ ¬´–ù–æ—á–Ω–æ–π –¢–µ—Ö–∞—Å¬ª',
    themeDarkDesc: '–¢—ë–º–Ω–∞—è —Ç–µ–º–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ‚Äî –Ω–µ–º–Ω–æ–≥–æ —Å—Ç–∏–ª—å–Ω–æ.',
    avatarPack: '–ü–∞–∫ –∞–≤–∞—Ç–∞—Ä–æ–≤',
    avatarPackDesc: '5 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —ç–º–æ–¥–∑–∏-–∞–≤–∞—Ç–∞—Ä–æ–≤ –¥–ª—è –±–æ—Ç–æ–≤/–≤–∞—Å.',
    voucherPack: '–ü–∞–∫ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ (√ó3)',
    voucherPackDesc: '–¢—Ä–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –≤–æ–∑–≤—Ä–∞—Ç–∞ –∞—Ç–∞–∫–∏ (–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –≤–∏—Ç—Ä–∏–Ω–µ).',
    hint: '–†–∞–∑–æ–≤—ã–π —Ö–∏–Ω—Ç',
    hintDesc: '–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–±–∏—Ä–∞–µ–º—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é —É –≤–∞—Å (–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ).',
    extraDraw: '–î–æ–ø. –≤—ã—Ç—è–∂–∫–∞',
    extraDrawDesc: '–ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–∫–∏–Ω—É—Ç—å –∫–∞—Ä—Ç—É –±–µ–∑ –≤–∑—è—Ç–∏—è –Ω–æ–≤–æ–π (–æ–¥–∏–Ω —Ä–∞–∑, –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è —Ä—É–∫–∏).',
    peekDeck: '–ü–æ–¥–≥–ª—è–¥ –≤ –∫–æ–ª–æ–¥—É',
    peekDeckDesc: '–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–µ—Ä—Ö–Ω—é—é –∫–∞—Ä—Ç—É –∫–æ–ª–æ–¥—ã (–æ–¥–∏–Ω —Ä–∞–∑).',
    skipTurn: '–ü—Ä–æ–ø—É—Å–∫ —Ö–æ–¥–∞',
    skipTurnDesc: '–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–≤–æ–π —Ö–æ–¥ –∞—Ç–∞–∫–∏ (–æ–¥–∏–Ω —Ä–∞–∑).',
    revealCombo: '–†–∞–∑–æ–±–ª–∞—á–µ–Ω–∏–µ –∫–æ–º–±–æ',
    revealComboDesc: '–£–∑–Ω–∞–π—Ç–µ —Ç–∏–ø –∫–æ–º–±–æ —É —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ (–æ–¥–∏–Ω —Ä–∞–∑).',
    extraLife: '–î–æ–ø. –∂–∏–∑–Ω—å',
    extraLifeDesc: '–ò–∑–±–µ–≥–Ω–∏—Ç–µ –ø–æ—Ä–∞–∂–µ–Ω–∏—è –æ–¥–∏–Ω —Ä–∞–∑, –µ—Å–ª–∏ –ø—Ä–æ–∏–≥—Ä–∞–µ—Ç–µ.',
    telepathy: '–¢–µ–ª–µ–ø–∞—Ç–∏—è',
    telepathyDesc: '–≤–∏–¥–∏—Ç —Å–ª—É—á–∞–π–Ω—É—é –∫–∞—Ä—Ç—É –∏–∑ —Ä—É–∫–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞',
    trumpSwap: '–ü–æ–¥–º–µ–Ω–∞ –ö–æ–∑—ã—Ä—è',
    trumpSwapDesc: '–æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ –∏–≥—Ä—É —Å–º–µ–Ω–∏—Ç—å –∫–æ–∑—ã—Ä—å',
    gameRoulette: '–†—É—Å—Å–∫–∞—è –†—É–ª–µ—Ç–∫–∞ –≤ –ò–≥—Ä–µ',
    gameRouletteDesc: '–∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ö–æ–¥ (50% —à–∞–Ω—Å)',
    antiLecho: '–ê–Ω—Ç–∏-–õ–µ—á–æ',
    antiLechoDesc: '–±–ª–æ–∫–∏—Ä—É–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è –õ–µ—á–æ –æ–¥–Ω–∏–º –∏–≥—Ä–æ–∫–æ–º',
    betDoubler: '–£–¥–≤–æ–∏—Ç–µ–ª—å –°—Ç–∞–≤–∫–∏',
    betDoublerDesc: '—Å–ª–µ–¥—É—é—â–∞—è –ø–æ–±–µ–¥–∞ –≤ –∫–∞–∑–∏–Ω–æ √ó2',
    insurance: '–°—Ç—Ä–∞—Ö–æ–≤–∫–∞',
    insuranceDesc: '–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 50% –ø—Ä–∏ –ø—Ä–æ–∏–≥—Ä—ã—à–µ –≤ –∫–∞–∑–∏–Ω–æ',
    freeSample: '–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –û–±—Ä–∞–∑–µ—Ü',
    freeSampleDesc: '—Ç–µ—Å—Ç–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª—é–±–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞',
    
    // –ü—Ä–∞–≤–∏–ª–∞
    rulesTitle: '–ü—Ä–∞–≤–∏–ª–∞',
    rulesIntro: '–ò–≥—Ä–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è ¬´–õ–µ—á–æ¬ª.',
    rulesCards: '–í –∏–≥—Ä–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è 4 –º–∞—Å—Ç–∏, –∫–∞–∫ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–Ω—ã—Ö –∏–≥—Ä–∞—Ö: ‚ô£Ô∏è‚ô†Ô∏è‚ô•Ô∏è‚ô¶Ô∏è. –ö–æ–ª–æ–¥–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 36 –∫–∞—Ä—Ç.',
    rulesDeal: '–ö–∞–∂–¥–æ–º—É –∏–≥—Ä–æ–∫—É —Ä–∞–∑–¥–∞–µ—Ç—Å—è –ø–æ 3 —Å–ª—É—á–∞–π–Ω—ã–µ –∫–∞—Ä—Ç—ã –∏–∑ –∫–æ–ª–æ–¥—ã. –°–∞–º–∞—è –Ω–∏–∂–Ω—è—è –∫–∞—Ä—Ç–∞ –≤ –∫–æ–ª–æ–¥–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–∑—ã—Ä—å –Ω–∞ –ø–∞—Ä—Ç–∏—é.',
    rulesStart: '–ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ä–∞–∑–¥–∞—á–∏. –ò–≥—Ä–æ–∫–∏ –º–æ–≥—É—Ç —Ö–æ–¥–∏—Ç—å (–∞—Ç–∞–∫–æ–≤–∞—Ç—å) –∏–ª–∏ –æ—Ç–±–∏–≤–∞—Ç—å—Å—è –∫–∞—Ä—Ç–∞–º–∏. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–∞—Ä—Ç—ã –¥–æ –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã –∑–∞–ø—Ä–µ—â–µ–Ω–æ. –ù–µ—Ç –¥—Ä—É–≥–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ö–æ–¥–∞. –ü–µ—Ä–≤—ã–π —Ö–æ–¥ –¥–µ–ª–∞–µ—Ç –∏–≥—Ä–æ–∫ —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º –∫–æ–∑—ã—Ä–µ–º, –¥–∞–ª–µ–µ –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ.',
    rulesAttack: '–ê—Ç–∞–∫—É—é—â–∏–π –∏–≥—Ä–æ–∫ –º–æ–∂–µ—Ç —Å–≤–∞–π–ø–æ–º –≤—ã–∫–∏–Ω—É—Ç—å –Ω–µ–Ω—É–∂–Ω—É—é –∫–∞—Ä—Ç—É, —á—Ç–æ–±—ã –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è —Å–æ–±—Ä–∞—Ç—å –∫–æ–º–±–∏–Ω–∞—Ü–∏—é, –≤–∑—è–≤ –Ω–æ–≤—É—é –∏–∑ –∫–æ–ª–æ–¥—ã. –ï—Å–ª–∏ –æ–±–æ—Ä–æ–Ω—è—é—â–∏–π—Å—è –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–±–∏—Ç—å –∞—Ç–∞–∫—É—é—â—É—é –∫–∞—Ä—Ç—É, –æ–Ω –∑–∞–±–∏—Ä–∞–µ—Ç –µ—ë —Å–µ–±–µ. –ï—Å–ª–∏ –∞—Ç–∞–∫–∞ –æ—Ç–±–∏—Ç–∞, –æ–±–µ –∫–∞—Ä—Ç—ã (–∞—Ç–∞–∫–∞ –∏ –æ—Ç–±–æ–π) –ø–µ—Ä–µ–º–µ—à–∏–≤–∞—é—Ç—Å—è –∏ –∫–ª–∞–¥—É—Ç—Å—è –≤ –∫–æ–ª–æ–¥—É –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –≤—ã—Ç—è–≥–∏–≤–∞–Ω–∏—è.',
    rulesCombos: '–ö–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è —Å—Ç—Ä–æ–≥–æ –∏–∑ 3 –∫–∞—Ä—Ç. –í—Å–µ–≥–æ 3 —Ç–∏–ø–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π:',
    rulesRepeat: '–ü–æ–≤—Ç–æ—Ä: 3 –∫–∞—Ä—Ç—ã –æ–¥–Ω–æ–≥–æ –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 6‚ô£Ô∏è, 6‚ô†Ô∏è, 6‚ô•Ô∏è).',
    rulesSequence: '–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 3 –∫–∞—Ä—Ç—ã –ø–æ–¥—Ä—è–¥ –ø–æ –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤—É, –æ—Ç –º–µ–Ω—å—à–µ–≥–æ –∫ –±–æ–ª—å—à–µ–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, J‚ô•Ô∏è, Q‚ô†Ô∏è, K‚ô£Ô∏è –∏–ª–∏ 6‚ô†Ô∏è, 7‚ô£Ô∏è, 8‚ô•Ô∏è).',
    rulesSuit: '–ú–∞—Å—Ç—å: 3 –∫–∞—Ä—Ç—ã –æ–¥–Ω–æ–π –º–∞—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 7‚ô•Ô∏è, Q‚ô•Ô∏è, A‚ô•Ô∏è –∏–ª–∏ 6‚ô£Ô∏è, 7‚ô£Ô∏è, 9‚ô£Ô∏è).',
    rulesLecho: '–ï—Å–ª–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è —Å–æ–±—Ä–∞–Ω–∞, –Ω–æ –∏–≥—Ä–æ–∫ –Ω–µ –Ω–∞–∂–∞–ª ¬´–õ–µ—á–æ¬ª, –∏–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è ‚Äî —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –∏–≥—Ä–æ–∫–∞. –ï—Å–ª–∏ –Ω–∞–∂–∞—Ç—å ¬´–õ–µ—á–æ¬ª –±–µ–∑ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏, –ø–æ—è–≤–∏—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: ¬´–í—ã –Ω–µ —Å–æ–±—Ä–∞–ª–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é!¬ª. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ ¬´–õ–µ—á–æ¬ª –∏–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç 1 ü™ô –∏ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É ‚Äî –æ–∂–∏–¥–∞—Ç—å –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã.',
    rulesEnd: '–ò–≥—Ä–∞ –¥–ª–∏—Ç—Å—è, –ø–æ–∫–∞ –Ω–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ–¥–∏–Ω –∏–≥—Ä–æ–∫ –±–µ–∑ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∏–ª–∏ –Ω–µ –æ–±—ä—è–≤–∏–≤—à–∏–π ¬´–õ–µ—á–æ¬ª timely.',
    rulesGuess: '–í –∫–æ–Ω—Ü–µ –∏–≥—Ä—ã –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏–π —É–≥–∞–¥—ã–≤–∞–µ—Ç –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –ø–æ –ø–æ–¥—Å–∫–∞–∑–∫–µ (—Ç–∏–ø –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏: –ø–æ–≤—Ç–æ—Ä, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–ª–∏ –º–∞—Å—Ç—å). –û–±–º–∞–Ω –∑–∞–ø—Ä–µ—â–µ–Ω. –ó–∞ –∫–∞–∂–¥—É—é —É–≥–∞–¥–∞–Ω–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –¥–∞–µ—Ç—Å—è 1 üíé.',
    rulesPenalty: '–ó–∞ –∫–∞–∂–¥—É—é –Ω–µ—É–≥–∞–¥–∞–Ω–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –∏–∑ –Ω–æ–≤–æ–π –∫–æ–ª–æ–¥—ã –≤—ã—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è 3 –∫–∞—Ä—Ç—ã. –ï—Å–ª–∏ –≤ –Ω–∏—Ö –µ—Å—Ç—å –∫–æ–º–±–∏–Ω–∞—Ü–∏—è, –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –µ—â–µ 3. –ï—Å–ª–∏ –≤—ã—Ç—è–Ω—É—Ç–æ –±–æ–ª—å—à–µ 15 –∫–∞—Ä—Ç, —ç—Ç–æ ¬´–∫–æ–ª–æ–¥–∞¬ª ‚Äî –∏–≥—Ä–æ–∫ –ø—Ä–æ–∏–≥—Ä–∞–ª –¥–≤–∞–∂–¥—ã.',
    
    // –ë–æ—Ç—ã
    botPrefixes: ['–ï–±–∞–Ω—ã–π','–•—É–µ–≤—ã–π','–ü–∏–∑–¥–∞—Ç—ã–π','–°—É–∫–∞','–ë–ª—è–¥—Å–∫–∏–π','–ü–∏–¥–æ—Ä—Å–∫–∏–π','–ì–æ–≤–Ω–æ','–ó–∞–ª—É–ø–Ω—ã–π','–ú—É–¥–∞–∫','–î–æ–ª–±–æ—ë–±'],
    botNames: ['–•—É–π','–ü–∏–∑–¥–µ—Ü','–ñ–æ–ø–∞','–°–∏—Å—å–∫–∏','–ë–ª—è–¥–∏–Ω–∞','–ü–∏–∑–¥—é–∫','–ú–∞–Ω–¥–∞–≤–æ—à–∫–∞','–ï–±–ª–∞–Ω','–î—Ä–æ—á–µ—Ä','–ö–æ–Ω—á–∞']
  },
  es: {
    home: 'Inicio',
    profile: 'Perfil',
    shop: 'Tienda', 
    newGame: 'Nuevo juego',
    rules: 'Reglas',
    casino: 'Casino',
    exchange: 'Intercambio',
    lechoBetting: 'Lecho por apuesta',
    
    attack: 'Ataca',
    you: '(T√∫)',
    yourTurn: 'Tu turno: toca una carta o presiona "Tomar".',
    waiting: 'Espera.',
    taking: 'Tomar',
    return: 'Devolver',
    lecho: 'Lecho',
    
    repeat: 'Repetici√≥n',
    sequence: 'Secuencia',
    suit: 'Palo',
    
    noStatus: 'Sin estado',
    conqueror: 'Conquistador de la fiebre',
    
    buy: 'Comprar',
    use: 'Usar',
    apply: 'Aplicar',
    save: 'Guardar',
    back: 'Atr√°s',
    
    // –ü—Ä–æ—Ñ–∏–ª—å
    language: 'Idioma',
    avatar: 'Avatar',
    balance: 'Saldo',
    inventory: 'Inventario',
    personalization: 'Personalizaci√≥n',
    applyAvatar: 'Aplicar avatar',
    
    // –ú–∞–≥–∞–∑–∏–Ω —Ç–æ–≤–∞—Ä—ã
    themeDark: 'Tema ¬´Texas Nocturno¬ª',
    themeDarkDesc: 'Tema oscuro de interfaz ‚Äî un poco elegante.',
    avatarPack: 'Paquete de avatares',
    avatarPackDesc: '5 avatares emoji √∫nicos para bots/t√∫.',
    voucherPack: 'Paquete de devoluciones (√ó3)',
    voucherPackDesc: 'Tres devoluciones gratuitas de ataque (se convierte en vitrina).',
    hint: 'Pista √∫nica',
    hintDesc: 'Muestra posible combinaci√≥n que puedes hacer (una vez).',
    extraDraw: 'Robo extra',
    extraDrawDesc: 'Permite descartar carta sin tomar nueva (una vez, para reducir mano).',
    peekDeck: 'Vistazo al mazo',
    peekDeckDesc: 'Muestra la carta superior del mazo (una vez).',
    skipTurn: 'Saltar turno',
    skipTurnDesc: 'Saltar tu turno de ataque (una vez).',
    revealCombo: 'Revelar combo',
    revealComboDesc: 'Descubre el tipo de combo de un oponente aleatorio (una vez).',
    extraLife: 'Vida extra',
    extraLifeDesc: 'Evita la derrota una vez, si pierdes.',
    telepathy: 'Telepat√≠a',
    telepathyDesc: 've carta aleatoria de la mano del oponente',
    trumpSwap: 'Cambio de Triunfo',
    trumpSwapDesc: 'cambiar triunfo una vez por juego',
    gameRoulette: 'Ruleta Rusa en Juego',
    gameRouletteDesc: 'hace que oponente pierda turno (50% chance)',
    antiLecho: 'Anti-Lecho',
    antiLechoDesc: 'bloquea posibilidad de declarar Lecho por un jugador',
    betDoubler: 'Duplicador de Apuesta',
    betDoublerDesc: 'siguiente victoria en casino √ó2',
    insurance: 'Seguro',
    insuranceDesc: 'devuelve 50% al perder en casino',
    freeSample: 'Muestra Gratuita',
    freeSampleDesc: 'uso de prueba de cualquier objeto',
    
    // –ü—Ä–∞–≤–∏–ª–∞
    rulesTitle: 'Reglas',
    rulesIntro: 'El juego se llama ¬´Lecho¬ª.',
    rulesCards: 'En el juego se usan 4 palos, como en juegos de cartas est√°ndar: ‚ô£Ô∏è‚ô†Ô∏è‚ô•Ô∏è‚ô¶Ô∏è. El mazo consta de 36 cartas.',
    rulesDeal: 'A cada jugador se le reparten 3 cartas aleatorias del mazo. La carta m√°s baja del mazo determina el triunfo para la partida.',
    rulesStart: 'El juego comienza despu√©s del reparto. Los jugadores pueden atacar o defenderse con cartas. Mostrar cartas antes del final del juego est√° prohibido. No hay otras opciones de movimiento. El primer movimiento lo hace el jugador con el triunfo m√°s bajo, luego en sentido horario.',
    rulesAttack: 'El jugador atacante puede deslizar para descartar una carta innecesaria, para tratar de formar una combinaci√≥n, tomando una nueva del mazo. Si el defensor no puede contrarrestar la carta atacante, la toma para s√≠. Si el ataque es contrarrestado, ambas cartas (ataque y contraataque) se mezclan y se ponen en el mazo para futuras extracciones.',
    rulesCombos: 'Las combinaciones se forman estrictamente con 3 cartas. Hay 3 tipos de combinaciones:',
    rulesRepeat: 'Repetici√≥n: 3 cartas del mismo valor (por ejemplo, 6‚ô£Ô∏è, 6‚ô†Ô∏è, 6‚ô•Ô∏è).',
    rulesSequence: 'Secuencia: 3 cartas consecutivas por valor, de menor a mayor (por ejemplo, J‚ô•Ô∏è, Q‚ô†Ô∏è, K‚ô£Ô∏è o 6‚ô†Ô∏è, 7‚ô£Ô∏è, 8‚ô•Ô∏è).',
    rulesSuit: 'Palo: 3 cartas del mismo palo (por ejemplo, 7‚ô•Ô∏è, Q‚ô•Ô∏è, A‚ô•Ô∏è o 6‚ô£Ô∏è, 7‚ô£Ô∏è, 9‚ô£Ô∏è).',
    rulesLecho: 'Si se forma una combinaci√≥n pero el jugador no presion√≥ ¬´Lecho¬ª, el juego contin√∫a ‚Äî es problema del jugador. Si presionar ¬´Lecho¬ª sin combinaci√≥n, aparece advertencia: ¬´¬°No formaste una combinaci√≥n!¬ª. Despu√©s de un ¬´Lecho¬ª exitoso el jugador recibe 1 ü™ô y no puede presionar el bot√≥n nuevamente ‚Äî esperar el final del juego.',
    rulesEnd: 'El juego dura hasta que quede un jugador sin combinaci√≥n o que no declar√≥ ¬´Lecho¬ª a tiempo.',
    rulesGuess: 'Al final del juego el perdedor adivina las combinaciones de los ganadores por pista (tipo de combinaci√≥n: repetici√≥n, secuencia o palo). El enga√±o est√° prohibido. Por cada combinaci√≥n adivinada se da 1 üíé.',
    rulesPenalty: 'Por cada combinaci√≥n no adivinada del nuevo mazo se extraen 3 cartas. Si hay una combinaci√≥n en ellas, se agregan 3 m√°s. Si se extraen m√°s de 15 cartas, es ¬´mazo¬ª ‚Äî el jugador perdi√≥ dos veces.',
    
    botPrefixes: ['Maldito','Jodido','Cabr√≥n','Hijo de','Puto','Mierda','Cagado','Chingado','Pinche','Pendejo'],
    botNames: ['Puta','Culo','Tetas','Cojones','Mierda','Pene','Vagina','Maric√≥n','Puto','Culero']
  },
  en: {
    home: 'Home',
    profile: 'Profile',
    shop: 'Shop',
    newGame: 'New Game',
    rules: 'Rules', 
    casino: 'Casino',
    exchange: 'Exchange',
    lechoBetting: 'Lecho Betting',
    
    attack: 'Attacks',
    you: '(You)',
    yourTurn: 'Your turn: tap a card or press "Take".',
    waiting: 'Wait.',
    taking: 'Take',
    return: 'Return',
    lecho: 'Lecho',
    
    repeat: 'Repeat',
    sequence: 'Sequence',
    suit: 'Suit',
    
    noStatus: 'No status',
    conqueror: 'Fever conqueror',
    
    buy: 'Buy',
    use: 'Use',
    apply: 'Apply',
    save: 'Save',
    back: 'Back',
    
    // –ü—Ä–æ—Ñ–∏–ª—å
    language: 'Language',
    avatar: 'Avatar',
    balance: 'Balance',
    inventory: 'Inventory',
    personalization: 'Personalization',
    applyAvatar: 'Apply avatar',
    
    // –ú–∞–≥–∞–∑–∏–Ω —Ç–æ–≤–∞—Ä—ã
    themeDark: 'Theme ¬´Night Texas¬ª',
    themeDarkDesc: 'Dark interface theme ‚Äî a bit stylish.',
    avatarPack: 'Avatar pack',
    avatarPackDesc: '5 unique emoji avatars for bots/you.',
    voucherPack: 'Return pack (√ó3)',
    voucherPackDesc: 'Three free attack returns (converts in showcase).',
    hint: 'One-time hint',
    hintDesc: 'Shows possible combination you can make (once).',
    extraDraw: 'Extra draw',
    extraDrawDesc: 'Allows discarding card without taking new (once, to reduce hand).',
    peekDeck: 'Peek deck',
    peekDeckDesc: 'Shows top card of deck (once).',
    skipTurn: 'Skip turn',
    skipTurnDesc: 'Skip your attack turn (once).',
    revealCombo: 'Reveal combo',
    revealComboDesc: 'Discover combo type of random opponent (once).',
    extraLife: 'Extra life',
    extraLifeDesc: 'Avoid defeat once, if you lose.',
    telepathy: 'Telepathy',
    telepathyDesc: 'sees random card from opponent hand',
    trumpSwap: 'Trump Swap',
    trumpSwapDesc: 'change trump once per game',
    gameRoulette: 'Russian Roulette in Game',
    gameRouletteDesc: 'makes opponent skip turn (50% chance)',
    antiLecho: 'Anti-Lecho',
    antiLechoDesc: 'blocks possibility to declare Lecho by one player',
    betDoubler: 'Bet Doubler',
    betDoublerDesc: 'next casino win √ó2',
    insurance: 'Insurance',
    insuranceDesc: 'returns 50% when losing in casino',
    freeSample: 'Free Sample',
    freeSampleDesc: 'test use of any item',
    
    // –ü—Ä–∞–≤–∏–ª–∞
    rulesTitle: 'Rules',
    rulesIntro: 'The game is called ¬´Lecho¬ª.',
    rulesCards: 'The game uses 4 suits, like in standard card games: ‚ô£Ô∏è‚ô†Ô∏è‚ô•Ô∏è‚ô¶Ô∏è. The deck consists of 36 cards.',
    rulesDeal: 'Each player is dealt 3 random cards from the deck. The bottom card in the deck determines the trump for the game.',
    rulesStart: 'The game starts after dealing. Players can attack or defend with cards. Showing cards before the end of the game is forbidden. There are no other move options. The first move is made by the player with the lowest trump, then clockwise.',
    rulesAttack: 'The attacking player can swipe to discard an unnecessary card, to try to form a combination, taking a new one from the deck. If the defender cannot counter the attacking card, they take it. If the attack is countered, both cards (attack and counter) are shuffled and put in the deck for further drawing.',
    rulesCombos: 'Combinations are formed strictly from 3 cards. There are 3 types of combinations:',
    rulesRepeat: 'Repeat: 3 cards of the same rank (e.g., 6‚ô£Ô∏è, 6‚ô†Ô∏è, 6‚ô•Ô∏è).',
    rulesSequence: 'Sequence: 3 consecutive cards by rank, from lower to higher (e.g., J‚ô•Ô∏è, Q‚ô†Ô∏è, K‚ô£Ô∏è or 6‚ô†Ô∏è, 7‚ô£Ô∏è, 8‚ô•Ô∏è).',
    rulesSuit: 'Suit: 3 cards of the same suit (e.g., 7‚ô•Ô∏è, Q‚ô•Ô∏è, A‚ô•Ô∏è or 6‚ô£Ô∏è, 7‚ô£Ô∏è, 9‚ô£Ô∏è).',
    rulesLecho: 'If a combination is formed but the player didn\'t press ¬´Lecho¬ª, the game continues ‚Äî it\'s the player\'s problem. If pressing ¬´Lecho¬ª without a combination, a warning appears: ¬´You didn\'t form a combination!¬ª. After a successful ¬´Lecho¬ª the player gets 1 ü™ô and cannot press the button again ‚Äî wait for the end of the game.',
    rulesEnd: 'The game lasts until one player remains without a combination or who didn\'t declare ¬´Lecho¬ª timely.',
    rulesGuess: 'At the end of the game the loser guesses the combinations of the winners by hint (combination type: repeat, sequence or suit). Cheating is forbidden. For each guessed combination 1 üíé is given.',
    rulesPenalty: 'For each unguessed combination from the new deck 3 cards are drawn. If there\'s a combination in them, 3 more are added. If more than 15 cards are drawn, it\'s ¬´deck¬ª ‚Äî the player lost twice.',
    
    botPrefixes: ['Fucking','Damn','Bloody','Shitty','Crap','Ass','Bitch','Bastard','Motherfucking','Dick'],
    botNames: ['Fuck','Shit','Ass','Tits','Dick','Pussy','Cock','Bitch','Whore','Slut']
  },
  fr: {
    home: 'Accueil',
    profile: 'Profil',
    shop: 'Boutique',
    newGame: 'Nouveau jeu',
    rules: 'R√®gles',
    casino: 'Casino', 
    exchange: '√âchange',
    lechoBetting: 'Lecho par pari',
    
    attack: 'Attaque',
    you: '(Vous)',
    yourTurn: 'Votre tour: touchez une carte ou appuyez sur "Prendre".',
    waiting: 'Attendez.',
    taking: 'Prendre',
    return: 'Retourner',
    lecho: 'Lecho',
    
    repeat: 'R√©p√©tition',
    sequence: 'S√©quence',
    suit: 'Couleur',
    
    noStatus: 'Aucun statut',
    conqueror: 'Conqu√©rant de la fi√®vre',
    
    buy: 'Acheter',
    use: 'Utiliser',
    apply: 'Appliquer',
    save: 'Sauvegarder',
    back: 'Retour',
    
    // –ü—Ä–æ—Ñ–∏–ª—å
    language: 'Langue',
    avatar: 'Avatar',
    balance: 'Solde',
    inventory: 'Inventaire',
    personalization: 'Personnalisation',
    applyAvatar: 'Appliquer avatar',
    
    // –ú–∞–≥–∞–∑–∏–Ω —Ç–æ–≤–∞—Ä—ã
    themeDark: 'Th√®me ¬´Texas Nocturne¬ª',
    themeDarkDesc: 'Th√®me sombre d\'interface ‚Äî un peu styl√©.',
    avatarPack: 'Pack d\'avatars',
    avatarPackDesc: '5 avatars emoji uniques pour bots/vous.',
    voucherPack: 'Pack de retours (√ó3)',
    voucherPackDesc: 'Trois retours gratuits d\'attaque (se convertit en vitrine).',
    hint: 'Indice unique',
    hintDesc: 'Montre combinaison possible que vous pouvez faire (une fois).',
    extraDraw: 'Pioche extra',
    extraDrawDesc: 'Permet de d√©fausser carte sans en prendre nouvelle (une fois, pour r√©duire main).',
    peekDeck: 'Regard dans le paquet',
    peekDeckDesc: 'Montre carte du dessus du paquet (une fois).',
    skipTurn: 'Passer tour',
    skipTurnDesc: 'Passer votre tour d\'attaque (une fois).',
    revealCombo: 'R√©v√©ler combo',
    revealComboDesc: 'D√©couvre type de combo d\'opposant al√©atoire (une fois).',
    extraLife: 'Vie extra',
    extraLifeDesc: '√âvite d√©faite une fois, si vous perdez.',
    telepathy: 'T√©l√©pathie',
    telepathyDesc: 'voit carte al√©atoire de la main d\'opposant',
    trumpSwap: '√âchange d\'Atout',
    trumpSwapDesc: 'changer atout une fois par jeu',
    gameRoulette: 'Roulette Russe en Jeu',
    gameRouletteDesc: 'fait que opposant passe tour (50% chance)',
    antiLecho: 'Anti-Lecho',
    antiLechoDesc: 'bloque possibilit√© de d√©clarer Lecho par un joueur',
    betDoubler: 'Doubleur de Pari',
    betDoublerDesc: 'prochaine victoire au casino √ó2',
    insurance: 'Assurance',
    insuranceDesc: 'retourne 50% en perdant au casino',
    freeSample: '√âchantillon Gratuit',
    freeSampleDesc: 'usage test de n\'importe quel objet',
    
    // –ü—Ä–∞–≤–∏–ª–∞
    rulesTitle: 'R√®gles',
    rulesIntro: 'Le jeu s\'appelle ¬´Lecho¬ª.',
    rulesCards: 'Le jeu utilise 4 couleurs, comme dans les jeux de cartes standard: ‚ô£Ô∏è‚ô†Ô∏è‚ô•Ô∏è‚ô¶Ô∏è. Le paquet se compose de 36 cartes.',
    rulesDeal: 'Chaque joueur re√ßoit 3 cartes al√©atoires du paquet. La carte du bas du paquet d√©termine l\'atout pour la partie.',
    rulesStart: 'Le jeu commence apr√®s la distribution. Les joueurs peuvent attaquer ou se d√©fendre avec des cartes. Montrer les cartes avant la fin du jeu est interdit. Il n\'y a pas d\'autres options de mouvement. Le premier mouvement est fait par le joueur avec l\'atout le plus bas, puis dans le sens horaire.',
    rulesAttack: 'Le joueur attaquant peut glisser pour d√©fausser une carte inutile, pour essayer de former une combinaison, en prenant une nouvelle du paquet. Si le d√©fenseur ne peut pas contrer la carte attaquante, il la prend. Si l\'attaque est contrecarr√©e, les deux cartes (attaque et contre) sont m√©lang√©es et mises dans le paquet pour d\'autres tirages.',
    rulesCombos: 'Les combinaisons sont form√©es strictement de 3 cartes. Il y a 3 types de combinaisons:',
    rulesRepeat: 'R√©p√©tition: 3 cartes de m√™me valeur (par exemple, 6‚ô£Ô∏è, 6‚ô†Ô∏è, 6‚ô•Ô∏è).',
    rulesSequence: 'S√©quence: 3 cartes cons√©cutives par valeur, du plus bas au plus haut (par exemple, J‚ô•Ô∏è, Q‚ô†Ô∏è, K‚ô£Ô∏è ou 6‚ô†Ô∏è, 7‚ô£Ô∏è, 8‚ô•Ô∏è).',
    rulesSuit: 'Couleur: 3 cartes de m√™me couleur (par exemple, 7‚ô•Ô∏è, Q‚ô•Ô∏è, A‚ô•Ô∏è ou 6‚ô£Ô∏è, 7‚ô£Ô∏è, 9‚ô£Ô∏è).',
    rulesLecho: 'Si une combinaison est form√©e mais le joueur n\'a pas appuy√© sur ¬´Lecho¬ª, le jeu continue ‚Äî c\'est le probl√®me du joueur. Si appuyer sur ¬´Lecho¬ª sans combinaison, un avertissement appara√Æt: ¬´Vous n\'avez pas form√© de combinaison!¬ª. Apr√®s un ¬´Lecho¬ª r√©ussi le joueur re√ßoit 1 ü™ô et ne peut plus appuyer sur le bouton ‚Äî attendre la fin du jeu.',
    rulesEnd: 'Le jeu dure jusqu\'√† ce qu\'il reste un joueur sans combinaison ou qui n\'a pas d√©clar√© ¬´Lecho¬ª √† temps.',
    rulesGuess: '√Ä la fin du jeu le perdant devine les combinaisons des gagnants par indice (type de combinaison: r√©p√©tition, s√©quence ou couleur). La triche est interdite. Pour chaque combinaison devin√©e 1 üíé est donn√©.',
    rulesPenalty: 'Pour chaque combinaison non devin√©e du nouveau paquet 3 cartes sont tir√©es. S\'il y a une combinaison dedans, 3 de plus sont ajout√©es. Si plus de 15 cartes sont tir√©es, c\'est ¬´paquet¬ª ‚Äî le joueur a perdu deux fois.',
    
    botPrefixes: ['Putain','Merde','Salaud','Connard','Encul√©','B√¢tard','Fils de','Bordel','Chier','Nique'],
    botNames: ['Putain','Merde','Cul','Bite','Chatte','Con','Pute','Salope','Encul√©','Nique']
  },
  de: {
    home: 'Start',
    profile: 'Profil',
    shop: 'Shop',
    newGame: 'Neues Spiel',
    rules: 'Regeln',
    casino: 'Kasino',
    exchange: 'Tausch',
    lechoBetting: 'Lecho Wetten',
    
    attack: 'Greift an',
    you: '(Du)',
    yourTurn: 'Dein Zug: Karte antippen oder "Nehmen" dr√ºcken.',
    waiting: 'Warten.',
    taking: 'Nehmen',
    return: 'Zur√ºckgeben',
    lecho: 'Lecho',
    
    repeat: 'Wiederholung',
    sequence: 'Sequenz',
    suit: 'Farbe',
    
    noStatus: 'Kein Status',
    conqueror: 'Fieber-Eroberer',
    
    buy: 'Kaufen',
    use: 'Verwenden',
    apply: 'Anwenden',
    save: 'Speichern',
    back: 'Zur√ºck',
    
    // –ü—Ä–æ—Ñ–∏–ª—å
    language: 'Sprache',
    avatar: 'Avatar',
    balance: 'Guthaben',
    inventory: 'Inventar',
    personalization: 'Personalisierung',
    applyAvatar: 'Avatar anwenden',
    
    // –ú–∞–≥–∞–∑–∏–Ω —Ç–æ–≤–∞—Ä—ã
    themeDark: 'Thema ¬´Nacht Texas¬ª',
    themeDarkDesc: 'Dunkles Interface-Theme ‚Äî etwas stilvoll.',
    avatarPack: 'Avatar-Pack',
    avatarPackDesc: '5 einzigartige Emoji-Avatare f√ºr Bots/Sie.',
    voucherPack: 'R√ºckgabe-Pack (√ó3)',
    voucherPackDesc: 'Drei kostenlose Angriffs-R√ºckgaben (konvertiert in Vitrine).',
    hint: 'Einmaliger Hinweis',
    hintDesc: 'Zeigt m√∂gliche Kombination, die Sie machen k√∂nnen (einmal).',
    extraDraw: 'Extra-Zug',
    extraDrawDesc: 'Erlaubt Karte abwerfen ohne neue zu nehmen (einmal, um Hand zu reduzieren).',
    peekDeck: 'Deck-Blick',
    peekDeckDesc: 'Zeigt oberste Karte des Decks (einmal).',
    skipTurn: 'Zug √ºberspringen',
    skipTurnDesc: 'Ihren Angriffszug √ºberspringen (einmal).',
    revealCombo: 'Combo enth√ºllen',
    revealComboDesc: 'Entdecke Combo-Typ von zuf√§lligem Gegner (einmal).',
    extraLife: 'Extra-Leben',
    extraLifeDesc: 'Vermeide Niederlage einmal, wenn Sie verlieren.',
    telepathy: 'Telepathie',
    telepathyDesc: 'sieht zuf√§llige Karte aus Gegnerhand',
    trumpSwap: 'Trumpf-Tausch',
    trumpSwapDesc: 'Trumpf einmal pro Spiel √§ndern',
    gameRoulette: 'Russisches Roulette im Spiel',
    gameRouletteDesc: 'l√§sst Gegner Zug √ºberspringen (50% Chance)',
    antiLecho: 'Anti-Lecho',
    antiLechoDesc: 'blockiert M√∂glichkeit Lecho von einem Spieler zu erkl√§ren',
    betDoubler: 'Einsatz-Verdoppler',
    betDoublerDesc: 'n√§chster Kasino-Sieg √ó2',
    insurance: 'Versicherung',
    insuranceDesc: 'gibt 50% zur√ºck beim Verlieren im Kasino',
    freeSample: 'Kostenlose Probe',
    freeSampleDesc: 'Test-Nutzung von jedem Gegenstand',
    
    // –ü—Ä–∞–≤–∏–ª–∞
    rulesTitle: 'Regeln',
    rulesIntro: 'Das Spiel hei√üt ¬´Lecho¬ª.',
    rulesCards: 'Das Spiel verwendet 4 Farben, wie in Standard-Kartenspielen: ‚ô£Ô∏è‚ô†Ô∏è‚ô•Ô∏è‚ô¶Ô∏è. Das Deck besteht aus 36 Karten.',
    rulesDeal: 'Jedem Spieler werden 3 zuf√§llige Karten aus dem Deck ausgeteilt. Die unterste Karte im Deck bestimmt den Trumpf f√ºr das Spiel.',
    rulesStart: 'Das Spiel beginnt nach dem Austeilen. Spieler k√∂nnen angreifen oder sich mit Karten verteidigen. Karten vor dem Ende des Spiels zu zeigen ist verboten. Es gibt keine anderen Zugoptionen. Der erste Zug wird vom Spieler mit dem niedrigsten Trumpf gemacht, dann im Uhrzeigersinn.',
    rulesAttack: 'Der angreifende Spieler kann wischen, um eine unn√∂tige Karte abzuwerfen, um zu versuchen, eine Kombination zu bilden, indem er eine neue aus dem Deck nimmt. Wenn der Verteidiger die angreifende Karte nicht kontern kann, nimmt er sie. Wenn der Angriff kontert wird, werden beide Karten (Angriff und Konter) gemischt und ins Deck f√ºr weitere Z√ºge gelegt.',
    rulesCombos: 'Kombinationen werden streng aus 3 Karten gebildet. Es gibt 3 Arten von Kombinationen:',
    rulesRepeat: 'Wiederholung: 3 Karten gleichen Rangs (z.B. 6‚ô£Ô∏è, 6‚ô†Ô∏è, 6‚ô•Ô∏è).',
    rulesSequence: 'Sequenz: 3 aufeinanderfolgende Karten nach Rang, von niedrig zu hoch (z.B. J‚ô•Ô∏è, Q‚ô†Ô∏è, K‚ô£Ô∏è oder 6‚ô†Ô∏è, 7‚ô£Ô∏è, 8‚ô•Ô∏è).',
    rulesSuit: 'Farbe: 3 Karten gleicher Farbe (z.B. 7‚ô•Ô∏è, Q‚ô•Ô∏è, A‚ô•Ô∏è oder 6‚ô£Ô∏è, 7‚ô£Ô∏è, 9‚ô£Ô∏è).',
    rulesLecho: 'Wenn eine Kombination gebildet wird, aber der Spieler nicht ¬´Lecho¬ª gedr√ºckt hat, geht das Spiel weiter ‚Äî es ist das Problem des Spielers. Wenn ¬´Lecho¬ª ohne Kombination gedr√ºckt wird, erscheint eine Warnung: ¬´Sie haben keine Kombination gebildet!¬ª. Nach einem erfolgreichen ¬´Lecho¬ª erh√§lt der Spieler 1 ü™ô und kann den Button nicht mehr dr√ºcken ‚Äî auf das Ende des Spiels warten.',
    rulesEnd: 'Das Spiel dauert, bis ein Spieler ohne Kombination √ºbrig bleibt oder der ¬´Lecho¬ª nicht rechtzeitig erkl√§rt hat.',
    rulesGuess: 'Am Ende des Spiels err√§t der Verlierer die Kombinationen der Gewinner durch Hinweis (Kombinationstyp: Wiederholung, Sequenz oder Farbe). Betrug ist verboten. F√ºr jede erratene Kombination wird 1 üíé gegeben.',
    rulesPenalty: 'F√ºr jede nicht erratene Kombination aus dem neuen Deck werden 3 Karten gezogen. Wenn darin eine Kombination ist, werden 3 weitere hinzugef√ºgt. Wenn mehr als 15 Karten gezogen werden, ist es ¬´Deck¬ª ‚Äî der Spieler hat zweimal verloren.',
    
    botPrefixes: ['Verdammter','Schei√ü','Arsch','Huren','Ficker','Bastard','Mist','Kack','Fuck','Dreck'],
    botNames: ['Fick','Schei√üe','Arsch','Titten','Schwanz','Fotze','Pimmel','Hure','Schlampe','Wichser']
  }
};

let currentLanguage = 'ru';

// –§—É–Ω–∫—Ü–∏—è snake_case to camelCase
function snakeToCamel(str) {
  return str.replace(/([-_][a-z])/g, group =>
    group.toUpperCase()
      .replace('-', '')
      .replace('_', '')
  );
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞
function t(key) {
  return TRANSLATIONS[currentLanguage][key] || TRANSLATIONS.ru[key] || key;
}

// –§—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã —è–∑—ã–∫–∞
function changeLanguage(lang) {
  currentLanguage = lang;
  sessionStorage.setItem('lecho_language', lang);
  const languageSelect = $('languageSelect');
  if (languageSelect) {
    languageSelect.value = lang;
  }
  updateAllTexts();
}

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤
function updateAllTexts() {
  // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
  if ($('btnIntro')) $('btnIntro').innerHTML = `<span>üè†</span><br>${t('home')}`;
  if ($('btnProfile')) $('btnProfile').innerHTML = `<span>üë§</span><br>${t('profile')}`;
  if ($('btnShop')) $('btnShop').innerHTML = `<span>üõí</span><br>${t('shop')}`;
  if ($('btnNew')) $('btnNew').innerHTML = `<span>üé≤</span><br>${t('newGame')}`;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –¥—Ä—É–≥–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
  if ($('btnRules')) $('btnRules').textContent = t('rules');
  if ($('btnCasino')) $('btnCasino').textContent = t('casino');
  if ($('btnExchange')) $('btnExchange').textContent = t('exchange');
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∏–≥—Ä–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
  if ($('drawBtn')) $('drawBtn').textContent = t('taking');
  if ($('returnBtn')) $('returnBtn').textContent = t('return');
  if ($('lechoBtn')) $('lechoBtn').textContent = t('lecho');
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–æ—Ñ–∏–ª—è (–∏—Å–ø–æ–ª—å–∑—É–µ–º data-translate –∞—Ç—Ä–∏–±—É—Ç—ã)
  // –≠—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç—ã —É–∂–µ –∏–º–µ—é—Ç data-translate –∞—Ç—Ä–∏–±—É—Ç—ã, –ø–æ—ç—Ç–æ–º—É –æ–Ω–∏ –æ–±–Ω–æ–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  
  if ($('applyAvatar')) $('applyAvatar').textContent = t('applyAvatar');
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–≥–∞–∑–∏–Ω
  document.querySelectorAll('.buyBtn').forEach(btn => {
    btn.textContent = t('buy');
  });
  document.querySelectorAll('.use-btn').forEach(btn => {
    btn.textContent = t('use');
  });
  document.querySelectorAll('.apply-btn').forEach(btn => {
    btn.textContent = t('apply');
  });
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø—Ü–∏–∏ –≤ —Å–µ–ª–µ–∫—Ç–µ —Å—Ç–∞—Ç—É—Å–æ–≤
  const statusSelect = $('statusSelect');
  if (statusSelect) {
    Array.from(statusSelect.options).forEach(option => {
      const translateKey = option.getAttribute('data-translate');
      if (translateKey) {
        option.textContent = t(translateKey);
      }
    });
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º data-translate
  document.querySelectorAll('[data-translate]').forEach(element => {
    const translateKey = element.getAttribute('data-translate');
    if (translateKey) {
      element.textContent = t(translateKey);
    }
  });
  
  // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –º–∞–≥–∞–∑–∏–Ω –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
  renderShop();
  updateGameInventory();
  renderPersonalization();
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–∑—ã–∫–∞
function initLanguage() {
  const savedLang = sessionStorage.getItem('lecho_language') || 'ru';
  currentLanguage = savedLang;
  const languageSelect = $('languageSelect');
  if (languageSelect) {
    languageSelect.value = savedLang;
  }
  updateAllTexts();
}

/* ================= CONFIG / STATE ================= */
const RETURN_COST = 5;
let balance = Number(sessionStorage.getItem('lecho_balance')||0);
let diamonds = Number(sessionStorage.getItem('lecho_diamonds')||0);
let betDoublerActive = false;
let insuranceActive = false;
let winsCount = Number(sessionStorage.getItem('lecho_wins')||0);
let lechoBettingUnlocked = winsCount >= 3;
let currentLechoBet = 0;
const DEFAULT_AVATAR = '';
const SHOP_KEY = 'lecho_shop_inventory';
const AVATARS_KEY = 'lecho_avatars';
const STATUS_KEY = 'lecho_status';
const $ = id => document.getElementById(id);

/* UI refs */
const ui = {
  playersRow: $('playersRow'), attackerSlot:$('attackerSlot'), defenderSlot:$('defenderSlot'),
  playerHand:$('playerHand'), deckCount:$('deckCount'), trumpCard:$('trumpCard'),
  log:$('log'), turnInfo:$('turnInfo'), actionHint:$('actionHint'),
  drawBtn:$('drawBtn'), lechoBtn:$('lechoBtn'), returnBtn:$('returnBtn'),
  balanceDisplay:$('balanceDisplay'), inventory:$('inventory'),
  gameInventory: $('gameInventory')
};

/* Game consts */
const RANKS=['6','7','8','9','10','J','Q','K','A'];
const SUITS=['‚ô£Ô∏è','‚ô†Ô∏è','‚ô•Ô∏è','‚ô¶Ô∏è'];
const RANK_VALUE = r => RANKS.indexOf(r);
const BOT_EMOJIS = ['üòº','ü¶æ','üçî','üî•','üßä','ü•ü','üßÜ','üéØ','üõ†','üçï'];
const PREFIXES = ['–ï–±–∞–Ω—ã–π','–•—É–µ–≤—ã–π','–ü–∏–∑–¥–∞—Ç—ã–π','–°—É–∫–∞','–ë–ª—è–¥—Å–∫–∏–π','–ü–∏–¥–æ—Ä—Å–∫–∏–π','–ì–æ–≤–Ω–æ','–ó–∞–ª—É–ø–Ω—ã–π','–ú—É–¥–∞–∫','–î–æ–ª–±–æ—ë–±'];
const FUN = ['–•—É–π','–ü–∏–∑–¥–µ—Ü','–ñ–æ–ø–∞','–°–∏—Å—å–∫–∏','–ë–ª—è–¥–∏–Ω–∞','–ü–∏–∑–¥—é–∫','–ú–∞–Ω–¥–∞–≤–æ—à–∫–∞','–ï–±–ª–∞–Ω','–î—Ä–æ—á–µ—Ä','–ö–æ–Ω—á–∞'];

/* Shop consts */
const SHOP_ITEMS = [
  { id:'theme_dark', title:'–¢–µ–º–∞ ¬´–ù–æ—á–Ω–æ–π –¢–µ—Ö–∞—Å¬ª', desc:'–¢—ë–º–Ω–∞—è —Ç–µ–º–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ‚Äî –Ω–µ–º–Ω–æ–≥–æ —Å—Ç–∏–ª—å–Ω–æ.', price:200, type:'theme' },
  { id:'avatar_pack', title:'–ü–∞–∫ –∞–≤–∞—Ç–∞—Ä–æ–≤', desc:'5 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —ç–º–æ–¥–∑–∏-–∞–≤–∞—Ç–∞—Ä–æ–≤ –¥–ª—è –±–æ—Ç–æ–≤/–≤–∞—Å.', price:125, type:'avatar' },
  { id:'voucher_pack', title:'–ü–∞–∫ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ (√ó3)', desc:'–¢—Ä–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –≤–æ–∑–≤—Ä–∞—Ç–∞ –∞—Ç–∞–∫–∏ (–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –≤–∏—Ç—Ä–∏–Ω–µ).', price:300, type:'voucher', qty:3 },
  { id:'hint', title:'–†–∞–∑–æ–≤—ã–π —Ö–∏–Ω—Ç', desc:'–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–±–∏—Ä–∞–µ–º—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é —É –≤–∞—Å (–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ).', price:100, type:'hint' },
  { id:'extra_draw', title:'–î–æ–ø. –≤—ã—Ç—è–∂–∫–∞', desc:'–ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–∫–∏–Ω—É—Ç—å –∫–∞—Ä—Ç—É –±–µ–∑ –≤–∑—è—Ç–∏—è –Ω–æ–≤–æ–π (–æ–¥–∏–Ω —Ä–∞–∑, –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è —Ä—É–∫–∏).', price:150, type:'extra_draw' },
  { id:'peek_deck', title:'–ü–æ–¥–≥–ª—è–¥ –≤ –∫–æ–ª–æ–¥—É', desc:'–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–µ—Ä—Ö–Ω—é—é –∫–∞—Ä—Ç—É –∫–æ–ª–æ–¥—ã (–æ–¥–∏–Ω —Ä–∞–∑).', price:200, type:'peek' },
  { id:'skip_turn', title:'–ü—Ä–æ–ø—É—Å–∫ —Ö–æ–¥–∞', desc:'–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–≤–æ–π —Ö–æ–¥ –∞—Ç–∞–∫–∏ (–æ–¥–∏–Ω —Ä–∞–∑).', price:300, type:'skip' },
  { id:'reveal_combo', title:'–†–∞–∑–æ–±–ª–∞—á–µ–Ω–∏–µ –∫–æ–º–±–æ', desc:'–£–∑–Ω–∞–π—Ç–µ —Ç–∏–ø –∫–æ–º–±–æ —É —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ (–æ–¥–∏–Ω —Ä–∞–∑).', price:300, type:'reveal' },
  { id:'extra_life', title:'–î–æ–ø. –∂–∏–∑–Ω—å', desc:'–ò–∑–±–µ–≥–Ω–∏—Ç–µ –ø–æ—Ä–∞–∂–µ–Ω–∏—è –æ–¥–∏–Ω —Ä–∞–∑, –µ—Å–ª–∏ –ø—Ä–æ–∏–≥—Ä–∞–µ—Ç–µ.', price:375, type:'extra_life' },
  { id:'telepathy', title:'–¢–µ–ª–µ–ø–∞—Ç–∏—è', desc:'–≤–∏–¥–∏—Ç —Å–ª—É—á–∞–π–Ω—É—é –∫–∞—Ä—Ç—É –∏–∑ —Ä—É–∫–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞', price:625, type:'telepathy' },
  { id:'trump_swap', title:'–ü–æ–¥–º–µ–Ω–∞ –ö–æ–∑—ã—Ä—è', desc:'–æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ –∏–≥—Ä—É —Å–º–µ–Ω–∏—Ç—å –∫–æ–∑—ã—Ä—å', price:750, type:'trump_swap' },
  { id:'game_roulette', title:'–†—É—Å—Å–∫–∞—è –†—É–ª–µ—Ç–∫–∞ –≤ –ò–≥—Ä–µ', desc:'–∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ö–æ–¥ (50% —à–∞–Ω—Å)', price:500, type:'game_roulette' },
  { id:'anti_lecho', title:'–ê–Ω—Ç–∏-–õ–µ—á–æ', desc:'–±–ª–æ–∫–∏—Ä—É–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è –õ–µ—á–æ –æ–¥–Ω–∏–º –∏–≥—Ä–æ–∫–æ–º', price:1000, type:'anti_lecho' },
  { id:'bet_doubler', title:'–£–¥–≤–æ–∏—Ç–µ–ª—å –°—Ç–∞–≤–∫–∏', desc:'—Å–ª–µ–¥—É—é—â–∞—è –ø–æ–±–µ–¥–∞ –≤ –∫–∞–∑–∏–Ω–æ √ó2', price:200, type:'bet_doubler' },
  { id:'insurance', title:'–°—Ç—Ä–∞—Ö–æ–≤–∫–∞', desc:'–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 50% –ø—Ä–∏ –ø—Ä–æ–∏–≥—Ä—ã—à–µ –≤ –∫–∞–∑–∏–Ω–æ', price:150, type:'insurance' },
  { id:'free_sample', title:'–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –û–±—Ä–∞–∑–µ—Ü', desc:'—Ç–µ—Å—Ç–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª—é–±–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞', price:75, type:'free_sample' }
];
const AVATAR_PACKS = {
  'avatar_pack': ['ü§†', 'üßî', 'üëπ', 'ü§ñ', 'üëª']
};
const STATUSES = {
  none: '–ë–µ–∑ —Å—Ç–∞—Ç—É—Å–∞',
  conqueror: '–ü–æ–∫–æ—Ä–∏—Ç–µ–ª—å –ª–∏—Ö–æ—Ä–∞–¥–∫–∏'
};
const HORSE_ODDS = {1: 1.5, 2: 2.0, 3: 3.0, 4: 5.0, 5: 8.0};

/* runtime state */
let deck=[], discard=[], trump=null, originalTrump=null, trumpSwapped = false;
let players=[], turnIndex=0, tableAttack=null, tableDefend=null;
let processing=false, selectedCardUid=null;
let lobbySize = Number($('lobbySize').value || 3);
let exchangeProcessing = false;

/* ================= Helpers ================= */
function shuffle(a){ for(let i=a.length-1;i>0;i--){ let j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } }
function makeDeck(){ const d=[]; for(const s of SUITS) for(const r of RANKS) d.push({rank:r,suit:s,uid:Math.random().toString(36).slice(2)}); return d; }
function log(msg){ try{ if(ui.log){ const el = document.createElement('div'); el.textContent = msg; ui.log.prepend(el); } }catch(e){} if (typeof console !== 'undefined') { try{ console.log(msg); }catch(_){} } }
function saveBalance(){ 
  sessionStorage.setItem('lecho_balance', String(balance)); 
  sessionStorage.setItem('lecho_diamonds', String(diamonds)); 
  sessionStorage.setItem('lecho_wins', String(winsCount)); 
  ui.balanceDisplay.textContent = `ü™ô ${balance} üíé ${diamonds}`; 
  $('slotBalance').textContent = diamonds; 
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
  const playerId = sessionStorage.getItem('lecho_player_id') || generatePlayerId();
  const nickname = sessionStorage.getItem('lecho_nick') || 'Player';
  savePlayerData(playerId, nickname, balance, diamonds, winsCount);
}
function pickBotEmoji(){ return BOT_EMOJIS[Math.floor(Math.random()*BOT_EMOJIS.length)]; }
function avatarHtml(a){ if(!a) return '<div class="avatar small">üë§</div>'; if(a.type==='emoji') return `<div class="avatar small">${a.value}</div>`; return `<div class="avatar small"><img src="${a.value}" style="width:100%;height:100%;object-fit:cover;border-radius:12px"/></div>`; }
function getStatusText(statusKey) { 
  if (statusKey === 'none') return t('noStatus');
  if (statusKey === 'conqueror') return t('conqueror');
  return STATUSES[statusKey] || ''; 
}

/* Modal helper */
function showModal(msg, title = '') {
  // replaced with toast
  const toast = $('toast');
  const msgEl = $('toastMsg');
  msgEl.innerHTML = title ? `<strong>${title}</strong><br>${msg}` : msg;
  toast.style.display = 'block';
  clearTimeout(showModal._t);
  showModal._t = setTimeout(()=>{ toast.style.display = 'none'; }, 2200);
}

/* ============== Lobby / Start ============== */
$('startFromIntro').onclick = ()=>{ lobbySize = Number($('lobbySize').value||3); startNewGame(); };
$('btnNew').onclick = ()=>{ lobbySize = Number($('lobbySize').value||3); try{ clearLog(); }catch(e){} startNewGame(); };
$('btnIntro').onclick = ()=>showScreen('screenIntro');
$('btnRules').onclick = ()=>showScreen('screenRules');
$('backFromRules').onclick = ()=>showScreen('screenIntro');
$('btnProfile').onclick = ()=>{ showScreen('screenProfile'); $('nickProfile').value = sessionStorage.getItem('lecho_nick') || genBotName(); loadAvatars(); const v = sessionStorage.getItem('lecho_avatar')||DEFAULT_AVATAR; if(v) { if(v.startsWith('data:')) { document.getElementById('profileAvatar').innerHTML = `<img src="${v}" style="width:100%;height:100%;object-fit:cover;border-radius:12px"/>`; } else { document.getElementById('profileAvatar').innerHTML = `<div class="avatar large">${v}</div>`; $('avatarSelect').value = v; } } const status = sessionStorage.getItem(STATUS_KEY) || 'none'; $('statusSelect').value = status; const won = status === 'conqueror'; $('goldRushBadge').style.display = won ? 'flex' : 'none'; const statusSel = $('statusSelect'); const conquerorOpt = Array.from(statusSel.options).find(o => o.value === 'conqueror'); if (conquerorOpt) conquerorOpt.disabled = !won; updateInventoryUI(); renderPersonalization(); updateBalText(); };
$('btnShop').onclick = ()=>showScreen('screenShop');
$('backFromShop').onclick = ()=>showScreen('screenIntro');
$('backFromProfile').onclick = ()=>showScreen('screenIntro');
$('backFromOutro').onclick = ()=>showScreen('screenIntro');
$('backFromGuess').onclick = ()=>showScreen('screenIntro');
$('backFromExchange').onclick = ()=>showScreen('screenIntro');
$('backFromCasino').onclick = ()=>showScreen('screenIntro');
$('backFromSlots').onclick = ()=>{ showScreen('screenCasino'); };
$('backFromHorseRace').onclick = ()=>{ showScreen('screenCasino'); resetHorseRace(); };
// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ª–µ—á–æ –Ω–∞ —Å—Ç–∞–≤–∫—É —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤ updateLechoBettingButton()
$('backFromLechoBetting').onclick = ()=>showScreen('screenIntro');

// –õ–µ—á–æ –Ω–∞ —Å—Ç–∞–≤–∫—É –ª–æ–≥–∏–∫–∞
$('lechoBetAmount').addEventListener('input', (e) => {
  const bet = Number(e.target.value);
  if (bet >= 3) {
    const potentialWin = Math.round(bet * 2.5); // 2.5x –≤—ã–∏–≥—Ä—ã—à
    $('lechoPotentialWin').textContent = `${potentialWin}ü™ô`;
  } else {
    $('lechoPotentialWin').textContent = '0ü™ô';
  }
});

$('startLechoBetting').onclick = () => {
  const bet = Number($('lechoBetAmount').value);
  if (bet < 3) {
    showModal('–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: 3ü™ô');
    return;
  }
  if (bet > balance) {
    showModal('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ü™ô');
    return;
  }
  
  // –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É
  balance -= bet;
  saveBalance();
  
  // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—ã—á–Ω—É—é –∏–≥—Ä—É, –Ω–æ —Å —Ñ–ª–∞–≥–æ–º —á—Ç–æ —ç—Ç–æ –∏–≥—Ä–∞ –Ω–∞ —Å—Ç–∞–≤–∫—É
  currentLechoBet = bet;
  lobbySize = Number($('lobbySize').value||3);
  startNewGame();
};

$('saveNick').onclick = ()=>{ 
  const n = $('nickProfile').value.trim() || genBotName(); 
  sessionStorage.setItem('lecho_nick', n); 
  if (n.toLowerCase() === '–º–∞k–∞–Ω') {
    balance += 9999;
    diamonds += 9999;
    saveBalance();
    showModal('–ü–∞—Å—Ö–∞–ª–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞! –ë–æ–Ω—É—Å –∑–∞ –Ω–∏–∫ –º–∞k–∞–Ω! üéâ');
  } else if (n.toLowerCase() === 'lavseh') {
    balance = -9999;
    diamonds = -9999;
    saveBalance();
    showModal('–ü–∞—Å—Ö–∞–ª–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞! –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –¥–ª—è lavseh üòà');
  }
  showScreen('screenIntro'); 
};
$('saveStatus').onclick = () => {
  const status = $('statusSelect').value;
  if (status === 'conqueror') {
    const won = (sessionStorage.getItem(STATUS_KEY) === 'conqueror');
    if (!won) {
      $('statusSelect').value = 'none';
      showModal('–≠—Ç–æ—Ç —Å—Ç–∞—Ç—É—Å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–±–µ–¥—ã –≤ ¬´–ó–æ–ª–æ—Ç–æ–π –ª–∏—Ö–æ—Ä–∞–¥–∫–µ¬ª.');
      return;
    }
  }
  sessionStorage.setItem(STATUS_KEY, status);
  showModal('–°—Ç–∞—Ç—É—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
};

/* avatar upload preview */
$('avatarInput').addEventListener('change', e=>{ const f = e.target.files && e.target.files[0]; if(!f) return; const r = new FileReader(); r.onload=()=>{ sessionStorage.setItem('lecho_avatar', r.result); document.getElementById('profileAvatar').innerHTML = `<img src="${r.result}" style="width:100%;height:100%;object-fit:cover;border-radius:12px"/>`; $('avatarSelect').value = ''; }; r.readAsDataURL(f); });

/* avatar select */
function loadAvatars() {
  const avs = JSON.parse(sessionStorage.getItem(AVATARS_KEY) || '[]');
  const sel = $('avatarSelect');
  sel.innerHTML = '<option value="">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π üë§</option>';
  avs.forEach(a => { 
    const opt = document.createElement('option'); 
    opt.value = a; 
    opt.textContent = a; 
    sel.appendChild(opt); 
  });
  const current = sessionStorage.getItem('lecho_avatar');
  if (current && !current.startsWith('data:') && avs.includes(current)) {
    sel.value = current;
  }
}
$('applyAvatar').onclick = () => {
  const val = $('avatarSelect').value;
  if (!val) {
    sessionStorage.removeItem('lecho_avatar');
    document.getElementById('profileAvatar').innerHTML = '<div class="avatar large">üë§</div>';
  } else {
    sessionStorage.setItem('lecho_avatar', val);
    document.getElementById('profileAvatar').innerHTML = `<div class="avatar large">${val}</div>`;
  }
};

function updateBalText() {
  $('balText').textContent = `ü™ô${balance} üíé${diamonds}`;
}

/* Exchange logic - with strict check and anti-farming */
$('diamondsToCoinsInput').addEventListener('input', (e) => {
  const amt = Number(e.target.value);
  const errorEl = $('diamondsToCoinsError');
  if (amt < 3 || amt % 3 !== 0) {
    $('diamondsToCoinsResult').textContent = '';
    errorEl.textContent = '–°—É–º–º–∞ —Ä–∞–∑–º–µ–Ω–∞ –Ω–µ –∫—Ä–∞—Ç–Ω–∞ 3!';
    errorEl.style.display = 'block';
  } else {
    const result = Math.floor(amt / 3);
    $('diamondsToCoinsResult').textContent = `ü™ô ${result}`;
    errorEl.style.display = 'none';
  }
});
$('coinsToDiamondsInput').addEventListener('input', (e) => {
  const amt = Number(e.target.value);
  const result = amt * 2;
  $('coinsToDiamondsResult').textContent = `üíé ${result}`;
});
$('btnExchange').onclick = () => showScreen('screenExchange');
$('confirmDiamondsToCoins').onclick = async () => {
  if (exchangeProcessing) return;
  exchangeProcessing = true;
  $('confirmDiamondsToCoins').disabled = true;
  const amt = Number($('diamondsToCoinsInput').value);
  if (amt < 3 || amt % 3 !== 0) { showModal('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫—Ä–∞—Ç–Ω–æ 3 –∏ >=3'); exchangeProcessing = false; $('confirmDiamondsToCoins').disabled = false; return; }
  const coins = Math.floor(amt / 3);
  if (diamonds < amt) { showModal('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ üíé'); exchangeProcessing = false; $('confirmDiamondsToCoins').disabled = false; return; }
  diamonds -= amt;
  balance += coins;
  saveBalance();
  showModal(`–ü–æ–ª—É—á–µ–Ω–æ ü™ô${coins}`);
  $('diamondsToCoinsInput').value = '';
  $('diamondsToCoinsResult').textContent = 'ü™ô 0';
  $('diamondsToCoinsError').style.display = 'none';
  await new Promise(resolve => setTimeout(resolve, 1000));
  exchangeProcessing = false;
  $('confirmDiamondsToCoins').disabled = false;
};
$('confirmCoinsToDiamonds').onclick = async () => {
  if (exchangeProcessing) return;
  exchangeProcessing = true;
  $('confirmCoinsToDiamonds').disabled = true;
  const amt = Number($('coinsToDiamondsInput').value);
  if (amt < 1) { showModal('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ >=1'); exchangeProcessing = false; $('confirmCoinsToDiamonds').disabled = false; return; }
  const dias = amt * 2;
  if (balance < amt) { showModal('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ü™ô'); exchangeProcessing = false; $('confirmCoinsToDiamonds').disabled = false; return; }
  balance -= amt;
  diamonds += dias;
  saveBalance();
  showModal(`–ü–æ–ª—É—á–µ–Ω–æ üíé${dias}`);
  $('coinsToDiamondsInput').value = '';
  $('coinsToDiamondsResult').textContent = 'üíé 0';
  await new Promise(resolve => setTimeout(resolve, 1000));
  exchangeProcessing = false;
  $('confirmCoinsToDiamonds').disabled = false;
};

/* Casino logic */
let selectedColor = null;
document.querySelectorAll('.color-btn').forEach(btn => {
  btn.onclick = () => {
    document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    selectedColor = btn.dataset.color;
    $('confirmColorChoice').style.display = 'block';
  };
});
$('btnCasino').onclick = () => { showScreen('screenCasino'); resetCasino(); };
$('backFromHorseRace').style.display = 'block';
// –ó–∞–±–µ–≥ –ª–æ—à–∞–¥–µ–π –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω
$('btnSlots').onclick = () => showScreen('screenSlots');

function resetCasino() {
  $('rouletteResult').innerHTML = '';
  $('colorResult').innerHTML = '';
  $('goldRushResult').innerHTML = '';
  $('confirmColorChoice').style.display = 'none';
  document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('selected'));
  selectedColor = null;
  $('confirmGoldRush').style.display = 'none';
  $('luckyBtn').style.display = 'block';
  const status = sessionStorage.getItem(STATUS_KEY) || 'none';
  const won = status === 'conqueror';
  if(won) {
    $('luckyBtn').style.background = 'gray';
    $('luckyBtn').textContent = '–ü–æ–±–µ–¥–∞ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞';
    $('luckyBtn').onclick = () => { showModal('–í—ã —É–∂–µ –ø–æ–∫–æ—Ä–∏–ª–∏ –ª–∏—Ö–æ—Ä–∞–¥–∫—É! –≠—Ç–∞ —É–¥–∞—á–∞ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è'); };
  } else {
    $('luckyBtn').style.background = 'var(--accent)';
    $('luckyBtn').textContent = '–ü–æ–≤–µ–∑–µ—Ç';
    $('luckyBtn').onclick = goldRushBet;
  }
  saveBalance();
}

let selectedHorse = null;
let raceInterval = null;
let currentTimeLeft = 0; // global for race timer
document.querySelectorAll('.horse-btn').forEach(btn => {
  btn.onclick = () => {
    document.querySelectorAll('.horse-btn').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    selectedHorse = parseInt(btn.dataset.horse);
    if ($('betAmount').value >= 1) {
      $('startRaceBtn').style.display = 'block';
    }
  };
});
$('betAmount').addEventListener('input', () => {
  if (selectedHorse && $('betAmount').value >= 1) {
    $('startRaceBtn').style.display = 'block';
  } else {
    $('startRaceBtn').style.display = 'none';
  }
});
$('startRaceBtn').onclick = () => {
  const bet = parseInt($('betAmount').value);
  if (bet < 1 || !selectedHorse || balance < bet) {
    showModal('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ü™ô –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω–∞—è —Å—Ç–∞–≤–∫–∞');
    return;
  }
  balance -= bet;
  saveBalance();
  // Ensure track is visible
  document.getElementById('raceTrack').style.display = 'flex';
  const raceTime = 25000 + Math.random() * 20000;
  currentTimeLeft = raceTime / 1000;
  $('#raceTimer').textContent = `–ó–∞–±–µ–≥: ${Math.ceil(currentTimeLeft)}—Å`;
  raceInterval = setInterval(() => {
    currentTimeLeft -= 0.1;
    $('#raceTimer').textContent = `–ó–∞–±–µ–≥: ${Math.ceil(currentTimeLeft)}—Å`;
    if (currentTimeLeft <= 0) clearInterval(raceInterval);
  }, 100);
  startRace(raceTime, bet, selectedHorse);
};

function resetHorseRace() {
  $('betAmount').value = '';
  document.querySelectorAll('.horse-btn').forEach(btn => btn.classList.remove('selected'));
  $('startRaceBtn').style.display = 'none';
  $('#raceTrack').style.display = 'none';
  $('#raceTimer').textContent = '';
  $('#raceResult').innerHTML = '';
  document.querySelectorAll('.progress-bar').forEach(pb => pb.style.width = '0%');
  document.querySelectorAll('.horse').forEach(h => {
    h.style.left = '0px';
    h.classList.remove('boost');
  });
  selectedHorse = null;
  if (raceInterval) clearInterval(raceInterval);
  currentTimeLeft = 0;
}

function startRace(duration, bet, selected) {
  const trackWidth = 500; // px
  const baseSpeeds = [0.8, 0.7, 0.6, 0.5, 0.4]; // higher number = faster base
  const jerkChances = [0.1, 0.15, 0.2, 0.25, 0.3]; // higher for higher odds
  let positions = [0, 0, 0, 0, 0];
  let jerkTimer = 0;
  const horses = document.querySelectorAll('.horse');
  const progressBars = document.querySelectorAll('.progress-bar');
  const interval = setInterval(() => {
    jerkTimer += 100;
    if (jerkTimer >= 2000 + Math.random() * 1000) {
      const horseIdx = Math.floor(Math.random() * 5);
      const chance = jerkChances[horseIdx];
      if (Math.random() < chance) {
        const boost = 1.1 + Math.random() * 0.4; // 10-50%
        horses[horseIdx].classList.add('boost');
        setTimeout(() => horses[horseIdx].classList.remove('boost'), 1000);
        positions[horseIdx] += trackWidth * boost * 0.1;
      }
      jerkTimer = 0;
    }
    let winner = null;
    for (let i = 0; i < 5; i++) {
      let speed = baseSpeeds[i];
      if (currentTimeLeft <= 3) speed *= 1.5; // last 3s accelerate
      positions[i] += speed * (trackWidth / duration) * 100;
      // Run right-to-left: start from right edge and move left
      const pos = Math.min(positions[i], trackWidth);
      const leftPx = Math.max(trackWidth - pos, 0);
      horses[i].style.left = `${leftPx}px`;
      progressBars[i].style.width = `${(pos / trackWidth) * 100}%`;
      if (pos >= trackWidth && !winner) {
        winner = i + 1;
        clearInterval(interval);
        if (raceInterval) clearInterval(raceInterval);
        const odds = HORSE_ODDS[winner];
        let winAmount = 0;
        if (winner === selected) {
          winAmount = Math.floor(bet * odds);
          balance += winAmount;
          $('#raceResult').innerHTML = `<div>üèÜ –õ–æ—à–∞–¥—å ${winner} –ø–æ–±–µ–¥–∏–ª–∞! –í–∞—à –≤—ã–∏–≥—Ä—ã—à: +${winAmount}ü™ô</div>`;
          // win animation
          document.body.style.animation = 'flash 0.5s';
          setTimeout(() => { document.body.style.animation = ''; }, 500);
        } else {
          $('#raceResult').innerHTML = `<div>üèÅ –õ–æ—à–∞–¥—å ${winner} –ø–æ–±–µ–¥–∏–ª–∞. –ü—Ä–æ–∏–≥—Ä—ã—à.</div>`;
        }
        saveBalance();
        setTimeout(resetHorseRace, 3000);
        return;
      }
    }
    if (currentTimeLeft <= 0) {
      clearInterval(interval);
      if (raceInterval) clearInterval(raceInterval);
      $('#raceResult').innerHTML = '<div>üèÅ –ó–∞–±–µ–≥ –∑–∞–≤–µ—Ä—à—ë–Ω!</div>';
      setTimeout(resetHorseRace, 2000);
    }
  }, 100);
}

// Russian Roulette
function applyCasinoModifiers(isWin, winAmount, betAmount) {
  if (isWin && winAmount > betAmount && betDoublerActive) {
    diamonds += winAmount;
    betDoublerActive = false;
    showModal('–£–¥–≤–æ–∏—Ç–µ–ª—å —Å—Ä–∞–±–æ—Ç–∞–ª!');
  } else if (!isWin && insuranceActive) {
    const refund = Math.floor(betAmount / 2);
    diamonds += refund;
    insuranceActive = false;
    showModal(`–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –≤–µ—Ä–Ω—É–ª–∞ ${refund}üíé`);
  }
  saveBalance();
}

$('startRoulette').onclick = () => {
  const bet = Number($('rouletteBet').value);
  if (bet < 1 || bet > diamonds) { showModal('–°—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 1 –∏ –Ω–µ –±–æ–ª—å—à–µ –±–∞–ª–∞–Ω—Å–∞ üíé'); return; }
  diamonds -= bet;
  saveBalance();
  const diff = $('rouletteDifficulty').value;
  const emptySlots = diff === 'easy' ? 5 : 1;
  const winSlots = emptySlots;
  const isWin = Math.random() < (winSlots / 6);
  const multiplier = diff === 'easy' ? 5/3 : 15/3;
  const winAmount = Math.round(bet * multiplier);
  let countdown = 3;
  const cdEl = $('countdown');
  cdEl.textContent = countdown;
  const interval = setInterval(() => {
    countdown--;
    if (countdown > 0) cdEl.textContent = countdown;
    else {
      clearInterval(interval);
      setTimeout(() => {
        cdEl.textContent = isWin ? 'üí®' : 'üí•';
        if (isWin) {
          diamonds += winAmount;
          $('rouletteResult').innerHTML = `<p>–í—ã–∏–≥—Ä—ã—à! +${winAmount}üíé</p>`;
          applyCasinoModifiers(true, winAmount, bet);
        } else {
          $('rouletteResult').innerHTML = '<p>–ü—Ä–æ–∏–≥—Ä—ã—à!</p>';
          applyCasinoModifiers(false, 0, bet);
        }
      }, 1000);
    }
  }, 1000);
};

// Color Roulette
$('confirmColorChoice').onclick = () => {
  const bet = Number($('colorBet').value);
  if (!selectedColor || bet < 1 || bet > diamonds) { showModal('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç, —Å—Ç–∞–≤–∫–∞ –º–∏–Ω–∏–º—É–º 1 –∏ –Ω–µ –±–æ–ª—å—à–µ –±–∞–ª–∞–Ω—Å–∞ üíé'); return; }
  diamonds -= bet;
  saveBalance();
  const colors = ['üî¥', '‚ö´Ô∏è', 'üü¢'];
  const probs = [0.45, 0.45, 0.10];
  let rand = Math.random();
  let chosenIdx = 0;
  let cum = 0;
  for (let i = 0; i < probs.length; i++) {
    cum += probs[i];
    if (rand <= cum) { chosenIdx = i; break; }
  }
  const chosenColor = colors[chosenIdx];
  const spinner = $('rouletteSpinner');
  spinner.textContent = selectedColor;
  let spinTime = 3000 + Math.random() * 3000;
  let start = Date.now();
  const spinInterval = setInterval(() => {
    spinner.textContent = colors[Math.floor(Math.random() * colors.length)];
  }, 100);
  setTimeout(() => {
    clearInterval(spinInterval);
    spinner.textContent = chosenColor;
    let winAmount = 0;
    let isWin = false;
    if (chosenColor === selectedColor) {
      const multiplier = chosenColor === 'üü¢' ? 50 : 2;
      winAmount = Math.round(bet * multiplier);
      isWin = true;
      $('colorResult').innerHTML = `<p>–í—ã–∏–≥—Ä—ã—à! +${winAmount}üíé</p>`;
    } else {
      $('colorResult').innerHTML = '<p>–ü—Ä–æ–∏–≥—Ä—ã—à!</p>';
      isWin = false;
    }
    diamonds += winAmount;
    applyCasinoModifiers(isWin, winAmount, bet);
    resetCasino();
  }, spinTime);
};

// Gold Rush
function goldRushBet() {
  const bet = Number($('goldBet').value);
  if (bet < 1 || bet > balance) { showModal('–°—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 1 –∏ –Ω–µ –±–æ–ª—å—à–µ –±–∞–ª–∞–Ω—Å–∞ ü™ô'); return; }
  balance -= bet;
  saveBalance();
  $('luckyBtn').style.display = 'none';
  $('confirmGoldRush').style.display = 'block';
  const isJackpot = Math.random() < 0.07;
  $('confirmGoldRush').onclick = () => {
    if (isJackpot) {
      const jackpot = Math.round(bet * 777 / 5);
      let step = 0;
      const target = balance + jackpot;
      const interval = setInterval(() => {
        step += jackpot / 10;
        if (step >= jackpot) {
          step = jackpot;
          clearInterval(interval);
          balance = target;
          saveBalance();
          document.body.style.animation = 'flash 0.5s';
          setTimeout(() => { document.body.style.animation = ''; }, 500);
          for (let i = 0; i < 20; i++) {
            const conf = document.createElement('div');
            conf.textContent = ['üéâ', 'üéä', 'üí∞'][Math.floor(Math.random() * 3)];
            conf.style.cssText = 'position:fixed; left:' + Math.random() * 100 + '%; top:100vh; font-size:30px; pointer-events:none; z-index:1000;';
            conf.style.animation = 'fall 2s forwards';
            document.body.appendChild(conf);
            setTimeout(() => conf.remove(), 2000);
          }
          $('goldRushResult').innerHTML = '<div style="font-size:40px;color:gold;text-align:center;">üéâ –î–ñ–ï–ö–ü–û–¢! +'+jackpot+'ü™ô üéä</div>';
          sessionStorage.setItem(STATUS_KEY, 'conqueror');
          $('luckyBtn').style.background = 'gray';
          $('luckyBtn').textContent = '–ü–æ–±–µ–¥–∞ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞';
          $('luckyBtn').onclick = () => { showModal('–í—ã —É–∂–µ –ø–æ–∫–æ—Ä–∏–ª–∏ –ª–∏—Ö–æ—Ä–∞–¥–∫—É! –≠—Ç–∞ —É–¥–∞—á–∞ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è'); };
        }
        const tempBal = balance - jackpot + step;
        ui.balanceDisplay.textContent = `ü™ô ${Math.round(tempBal)} üíé ${diamonds}`;
      }, 100);
      let winAmount = jackpot;
      if (betDoublerActive) {
        balance += winAmount;
        betDoublerActive = false;
        showModal('–£–¥–≤–æ–∏—Ç–µ–ª—å —Å—Ä–∞–±–æ—Ç–∞–ª!');
        saveBalance();
      }
    } else {
      $('goldRushResult').innerHTML = '<div style="font-size:30px;text-align:center;">üòî –ù–µ –ø–æ–≤–µ–∑–ª–æ!</div><div class="big-btn" id="tryAgainGold" style="margin-top:10px;">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</div>';
      $('tryAgainGold').onclick = () => { resetCasino(); };
      if (insuranceActive) {
        const refund = Math.floor(bet / 2);
        balance += refund;
        insuranceActive = false;
        showModal('–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –≤–µ—Ä–Ω—É–ª–∞ '+refund+'ü™ô');
        saveBalance();
      }
    }
    resetCasino();
  };
}

/* Slot Machine - —É–ª—É—á—à–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ */
const symbols = ['üçí', 'üçã', 'üçä', 'üîî', 'üíé', '‚≠êÔ∏è', 'üíÄ'];
const symbolWeights = [0.25, 0.25, 0.25, 0.15, 0.05, 0.03, 0.02]; // –≤–µ—Å–∞ —Å–∏–º–≤–æ–ª–æ–≤
$('leverBtn').onclick = () => {
  const bet = Number($('slotsBet').value);
  if (bet < 1 || bet > diamonds) { showModal('–°—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 1 –∏ –Ω–µ –±–æ–ª—å—à–µ –±–∞–ª–∞–Ω—Å–∞ üíé'); return; }
  diamonds -= bet;
  saveBalance();
  const reel1 = $('reel1');
  const reel2 = $('reel2');
  const reel3 = $('reel3');
  const resultEl = $('slotResult');
  resultEl.innerHTML = '';
  const times = [2000 + Math.random() * 1000, 2500 + Math.random() * 1000, 3000 + Math.random() * 1000];
  let results = [];
  let skullAppeared = false;
  
  function getWeightedSymbol() {
    const rand = Math.random();
    let cumulative = 0;
    for (let i = 0; i < symbols.length; i++) {
      cumulative += symbolWeights[i];
      if (rand <= cumulative) return symbols[i];
    }
    return symbols[symbols.length - 1];
  }
  
  function spinReel(reel, time, callback) {
    const spinInt = setInterval(() => {
      reel.textContent = symbols[Math.floor(Math.random() * symbols.length)];
    }, 150);
    setTimeout(() => {
      clearInterval(spinInt);
      const finalSym = getWeightedSymbol();
      reel.textContent = finalSym;
      if (finalSym === 'üíÄ') skullAppeared = true;
      callback(finalSym);
    }, time);
  }
  
  function checkResults() {
    if (results.length === 3) {
      let winAmount = 0;
      let isWin = false;
      if (skullAppeared) {
        resultEl.innerHTML = 'üíÄ –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø—Ä–æ–∏–≥—Ä—ã—à!';
        isWin = false;
      } else {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
        const bellCount = results.filter(s => s === 'üîî').length;
        const diamondCount = results.filter(s => s === 'üíé').length;
        const starCount = results.filter(s => s === '‚≠êÔ∏è').length;
        
        if (diamondCount === 3) {
          winAmount = Math.round(bet * 50);
          resultEl.innerHTML = 'üíéüíéüíé –ú–ï–ì–ê –î–ñ–ï–ö–ü–û–¢! +'+winAmount+'üíé';
          isWin = true;
        } else if (starCount === 3) {
          winAmount = Math.round(bet * 25);
          resultEl.innerHTML = '‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è –°–£–ü–ï–† –î–ñ–ï–ö–ü–û–¢! +'+winAmount+'üíé';
          isWin = true;
        } else if (bellCount === 3) {
          winAmount = Math.round(bet * 15);
          resultEl.innerHTML = 'üîîüîîüîî –î–ñ–ï–ö–ü–û–¢! +'+winAmount+'üíé';
          isWin = true;
        } else if (diamondCount === 2) {
          winAmount = Math.round(bet * 8);
          resultEl.innerHTML = 'üíéüíé +'+winAmount+'üíé';
          isWin = true;
        } else if (starCount === 2) {
          winAmount = Math.round(bet * 5);
          resultEl.innerHTML = '‚≠êÔ∏è‚≠êÔ∏è +'+winAmount+'üíé';
          isWin = true;
        } else if (bellCount === 2) {
          winAmount = Math.round(bet * 3);
          resultEl.innerHTML = 'üîîüîî +'+winAmount+'üíé';
          isWin = true;
        } else {
          const fruits = results.filter(s => ['üçí', 'üçã', 'üçä'].includes(s));
          if (fruits.length === 3 && new Set(fruits).size === 1) {
            winAmount = Math.round(bet * 2);
            resultEl.innerHTML = `${fruits[0]}√ó3 +`+winAmount+'üíé';
            isWin = true;
          } else if (fruits.length === 2) {
            winAmount = Math.round(bet * 1.2);
            resultEl.innerHTML = '–§—Ä—É–∫—Ç—ã +'+winAmount+'üíé';
            isWin = true;
          } else {
            winAmount = 0;
            resultEl.innerHTML = '–ü—Ä–æ–∏–≥—Ä—ã—à';
            isWin = false;
          }
        }
      }
      diamonds += winAmount;
      applyCasinoModifiers(isWin && winAmount > bet, winAmount, bet);
    }
  }
  spinReel(reel1, times[0], sym => { results.push(sym); checkResults(); });
  spinReel(reel2, times[1], sym => { results.push(sym); checkResults(); });
  spinReel(reel3, times[2], sym => { results.push(sym); checkResults(); });
};

/* ============== GAME CORE ============== */
function startNewGame(){
  processing=false;
  trumpSwapped = false;
  deck = makeDeck(); shuffle(deck); discard=[];
  trump = deck[deck.length-1].suit; originalTrump = trump;
  players = [];
  const humanName = sessionStorage.getItem('lecho_nick') || genBotName();
  const humanStatus = sessionStorage.getItem(STATUS_KEY) || 'none';
  let humanAvatar = null;
  const avatarStr = sessionStorage.getItem('lecho_avatar');
  if (avatarStr) {
    if (avatarStr.startsWith('data:')) {
      humanAvatar = {type: 'img', value: avatarStr};
    } else {
      humanAvatar = {type: 'emoji', value: avatarStr};
    }
  }
  players.push({id:0,name:humanName,isHuman:true,hand:[],finished:false,avatar:humanAvatar,skipNextAttack:false,comboType:null,comboCards:[],antiLecho:false,status:humanStatus});
  for(let i=1;i<lobbySize;i++) players.push({id:i,name:genBotName(),isHuman:false,hand:[],finished:false,avatar:{type:'emoji',value:pickBotEmoji()},skipNextAttack:false,comboType:null,comboCards:[],antiLecho:false,status:'none'});
  for(let k=0;k<3;k++) for(const p of players) p.hand.push(deck.pop());
  let minV=Infinity,startIdx=0;
  players.forEach((p,idx)=> p.hand.forEach(c=>{ if(c.suit===trump){ const v=RANK_VALUE(c.rank); if(v<minV){minV=v;startIdx=idx;} } }));
  turnIndex = startIdx;
  tableAttack=null; tableDefend=null;
  $('deckCount').textContent = deck.length;
  $('trumpCard').textContent = trump;
  ui.playersRow.style.gridTemplateColumns = `repeat(${lobbySize}, 1fr)`;
  clearLog(); log(`–ù–æ–≤–∞—è –∏–≥—Ä–∞. –ö–æ–∑—ã—Ä—å: ${trump}. –ê—Ç–∞–∫—É–µ—Ç: ${players[turnIndex].name}`);
  showScreen('screenGame'); renderAll(); updateGameInventory(); setTimeout(()=>maybeAutoPlay(),420);
}

/* generate bot name */
function genBotName(){ 
  const prefixes = t('botPrefixes');
  const names = t('botNames');
  const pre = prefixes[Math.floor(Math.random()*prefixes.length)]; 
  const fun = names[Math.floor(Math.random()*names.length)]; 
  return pre + fun + '_' + Math.floor(Math.random()*100); 
}

function clearLog(){ try{ if(ui.log){ ui.log.innerHTML=''; } }catch(e){} }

function renderAll(){
  // players row: static grid
  ui.playersRow.innerHTML='';
  const sizeClass = lobbySize<=3 ? 'medium' : 'small';
  for(const p of players){
    const chip = document.createElement('div'); chip.className = 'player-chip';
    const avatarSizeClass = sizeClass;
    const avatarHtml = p.avatar ? (p.avatar.type==='emoji' ? `<div class="avatar ${avatarSizeClass}">${p.avatar.value}</div>` : `<div class="avatar ${avatarSizeClass}"><img src="${p.avatar.value}" style="width:100%;height:100%;object-fit:cover;border-radius:12px"/></div>`) : `<div class="avatar ${avatarSizeClass}">üë§</div>`;
    const statusHtml = p.status !== 'none' ? `<div class="player-status">${getStatusText(p.status)}</div>` : '';
    chip.innerHTML = `${avatarHtml}<div class="player-name">${p.name}</div>${statusHtml}<div class="player-count">–ö–∞—Ä—Ç: ${p.hand.length}${p.finished? ' ‚úÖ' : ''}</div>`;
    ui.playersRow.appendChild(chip);
  }

  // render table slots & player hand
  ui.attackerSlot.innerHTML=''; ui.defenderSlot.innerHTML='';
  if(tableAttack) ui.attackerSlot.appendChild(renderCardElt(tableAttack,true));
  if(tableDefend) ui.defenderSlot.appendChild(renderCardElt(tableDefend,true));
  ui.playerHand.innerHTML='';
  for(const c of players[0].hand){
    const el = renderCardElt(c,true);
    el.onclick = ()=>onPlayerCardClick(c.uid);
    if(selectedCardUid===c.uid) el.classList.add('selected');
    ui.playerHand.appendChild(el);
  }
  $('deckCount').textContent = deck.length; $('trumpCard').textContent = trump;
  updateTurnInfo(); updateActionHint(); saveBalance();
}

function renderCardElt(card,faceUp=true){
  const el = document.createElement('div'); el.className = 'card' + (faceUp?'':' back');
  if(faceUp) el.innerHTML = `<div class="suit">${card.suit}</div><div class="rank">${card.rank}</div><div style="text-align:right" class="suit">${card.suit}</div>`;
  else el.textContent='üÇ†';
  el.dataset.cardId = card.uid; return el;
}
function findCardOwner(uid){ for(let i=0;i<players.length;i++) if(players[i].hand.find(c=>c.uid===uid)) return i; return null; }

function detectCombo(hand){ if(!hand || hand.length !== 3) return null; return evalTriple(hand); }
function evalTriple(triple){ const ranks=triple.map(x=>x.rank), suits=triple.map(x=>x.suit); if(ranks[0]===ranks[1]&&ranks[1]===ranks[2]) return t('repeat'); const vals = triple.map(x=>RANK_VALUE(x.rank)).sort((a,b)=>a-b); if(vals[1]===vals[0]+1 && vals[2]===vals[1]+1) return t('sequence'); if(suits[0]===suits[1]&&suits[1]===suits[2]) return t('suit'); return null; }

function nextNonFinishedIndex(idx){
  const n = players.length;
  const start = idx;
  idx = (idx + 1) % n;
  while (idx !== start) {
    const p = players[idx];
    if (!p.finished) return idx;
    idx = (idx + 1) % n;
  }
  return null;
}
function nextAliveIndexForHint(idx){ const n=players.length; for(let i=1;i<=n;i++){ const ni=(idx+i)%n; if(!players[ni].finished) return ni; } return null; }
function updateTurnInfo(){ const atk = players[turnIndex]; ui.turnInfo.textContent = `${t('attack')}: ${atk.name} ${atk.isHuman? t('you'):''}`; }
function updateActionHint(){ if(processing){ ui.actionHint.textContent='–ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ö–æ–¥...'; return; } if(tableAttack && !tableDefend){ const def = nextAliveIndexForHint(turnIndex); if(def===0) ui.actionHint.textContent = `–í–∞—Å –∞—Ç–∞–∫—É—é—Ç ${tableAttack.rank}${tableAttack.suit}. –ù–∞–∂–º–∏—Ç–µ –∫–∞—Ä—Ç—É –¥–ª—è –∑–∞—â–∏—Ç—ã –∏–ª–∏ "${t('taking')}" —á—Ç–æ–±—ã –≤–∑—è—Ç—å –∞—Ç–∞–∫—É.`; else ui.actionHint.textContent = `${players[def].name} –∑–∞—â–∏—â–∞–µ—Ç—Å—è...`; return; } const atk = players[turnIndex]; if(atk.isHuman && !atk.finished) ui.actionHint.textContent = t('yourTurn'); else ui.actionHint.textContent = `–•–æ–¥: ${atk.name}. ${t('waiting')}`; }

function onPlayerCardClick(uid){
  if(processing) return;
  const owner = findCardOwner(uid);
  if(owner===null) return;
  if(selectedCardUid===uid){ selectedCardUid=null; renderAll(); return; }
  selectedCardUid=uid; renderAll();
  
  if(turnIndex===0 && players[0].isHuman && !tableAttack && !players[0].finished){
    playAttackCard(0, uid); selectedCardUid=null; return;
  }
  const defenderIdx = nextAliveIndexForHint(turnIndex);
  if(tableAttack && defenderIdx===0 && !tableDefend && !players[0].finished){
    playDefendCard(0, uid); selectedCardUid=null; return;
  }
}

/* play attack */
function playAttackCard(attackerIdx, cardUid){
  if(processing) return;
  const p = players[attackerIdx]; if(p.finished) return;
  const ci = p.hand.findIndex(c=>c.uid===cardUid); if(ci<0) return;
  const card = p.hand.splice(ci,1)[0];
  tableAttack = card; tableDefend = null; renderAll(); log(`${p.name} –∞—Ç–∞–∫—É–µ—Ç ${card.rank}${card.suit}`);
  processing = true;
  const defenderIdx = nextAliveIndexForHint(attackerIdx);
  setTimeout(()=>resolveDefense(attackerIdx, defenderIdx), 600);
}

/* play defend human */
function playDefendCard(defenderIdx, cardUid){
  if(processing) return; if(!tableAttack) return;
  const p = players[defenderIdx]; const ci = p.hand.findIndex(c=>c.uid===cardUid); if(ci<0) return;
  const card = p.hand[ci]; const attack = tableAttack;
  const canBeat = (card.suit===attack.suit && RANK_VALUE(card.rank)>RANK_VALUE(attack.rank)) || (card.suit===trump && attack.suit!==trump);
  if(!canBeat){ log('–≠—Ç—É –∫–∞—Ä—Ç—É –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∑–∞—â–∏—Ç—ã'); return; }
  p.hand.splice(ci,1); tableDefend = card; renderAll(); log(`${p.name} –æ—Ç–±–∏–ª ${attack.rank}${attack.suit} –∫–∞—Ä—Ç–æ–π ${card.rank}${card.suit}`);
  processing = true;
  setTimeout(()=>{ pushToDiscardRandom(tableAttack, tableDefend); tableAttack=null; tableDefend=null; processing=false; endOfTurnCleanup(findPreviousAttackerIndex(defenderIdx)); }, 420);
}

/* resolve defense for bots */
function resolveDefense(attackerIdx, defenderIdx){
  if(!tableAttack){ processing=false; renderAll(); return; }
  const defender = players[defenderIdx];
  const attack = tableAttack;
  if(defender.isHuman){ processing=false; updateActionHint(); return; }
  processing = true;
  setTimeout(()=>{
    const options = defender.hand.map((c,idx)=>({c,idx})).filter(o=>{
      const c=o.c; if(c.suit===attack.suit && RANK_VALUE(c.rank)>RANK_VALUE(attack.rank)) return true; if(c.suit===trump && attack.suit!==trump) return true; return false;
    });
    let shouldDefend = options.length > 0;
    if(shouldDefend){
      const costs = options.map(o => cardUsefulness(defender, o.c));
      const minCost = Math.min(...costs);
      let takeBenefit = cardUsefulness(defender, attack);
      const tempHand = [...defender.hand, attack];
      if(detectCombo(tempHand)) takeBenefit += 100;
      if(takeBenefit > minCost + 5) shouldDefend = false;
    }
    if(shouldDefend){
      options.sort((a,b)=>cardUsefulness(defender,a.c) - cardUsefulness(defender,b.c));
      const choose = options[0];
      const defendCard = defender.hand.splice(choose.idx,1)[0];
      tableDefend = defendCard;
      renderAll(); log(`${defender.name} –æ—Ç–±–∏–ª ${attack.rank}${attack.suit} –∫–∞—Ä—ÇÔøΩÔøΩ–π ${defendCard.rank}${defendCard.suit}`);
      setTimeout(()=>{ pushToDiscardRandom(tableAttack, tableDefend); tableAttack=null; tableDefend=null; checkLechoForBots(); processing=false; endOfTurnCleanup(attackerIdx); }, 350);
    } else {
      defender.hand.push(tableAttack);
      defender.skipNextAttack = true;
      log(`${defender.name} –Ω–µ –æ—Ç–±–∏–ª—Å—è –∏ –∑–∞–±–∏—Ä–∞–µ—Ç ${attack.rank}${attack.suit} (–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —à–∞–Ω—Å –∞—Ç–∞–∫–æ–≤–∞—Ç—å)`);
      tableAttack=null; tableDefend=null; checkLechoForBots(); processing=false; 
      // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∏–≥—Ä–æ–∫—É –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –∑–∞—â–∏—Ç–Ω–∏–∫ –≤–∑—è–ª –∫–∞—Ä—Ç—É
      const next = nextNonFinishedIndex(attackerIdx);
      if(next !== null) turnIndex = next;
      endOfTurnCleanup(attackerIdx);
    }
  }, 500 + Math.floor(Math.random()*450));
}

function findPreviousAttackerIndex(defIdx){ const n=players.length; for(let i=1;i<=n;i++){ const idx=(defIdx - i + n)%n; if(!players[idx].finished) return idx; } return defIdx; }
function pushToDiscardRandom(a,b){ const arr=[a,b]; shuffle(arr); discard.push(...arr); }

function endOfTurnCleanup(attackerIdx){
  ensureDeck();
  const n=players.length;
  for(let i=0;i<n;i++){
    const idx=(attackerIdx + i) % n; const p=players[idx]; if(p.finished) continue;
    while(p.hand.length < 3){ ensureDeck(); if(deck.length===0) break; p.hand.push(deck.pop()); }
  }
  checkLechoForBots();
  
  // –ù–∞—Ö–æ–¥–∏–º —Å–ª–µ–¥—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç —Ö–æ–¥–∏—Ç—å
  const next = nextNonFinishedIndex(attackerIdx);
  if(next !== null) {
    turnIndex = next;
  } else {
    turnIndex = (attackerIdx + 1) % n;
  }
  
  renderAll();
  setTimeout(()=>maybeAutoPlay(), 350);
}

/* draw button */
ui.drawBtn.onclick = ()=>{
  if(processing) return;
  const p = players[0];
  const defenderIdx = nextAliveIndexForHint(turnIndex);
  if(tableAttack && defenderIdx === 0 && !players[0].finished){
    players[0].hand.push(tableAttack);
    players[0].skipNextAttack = true;
    log(`–í—ã –≤–∑—è–ª–∏ –∞—Ç–∞–∫—É ${tableAttack.rank}${tableAttack.suit} (–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–Ω—Å –∞—Ç–∞–∫–æ–≤–∞—Ç—å)`);
    tableAttack=null; tableDefend=null; renderAll();
    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∏–≥—Ä–æ–∫—É –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –∏–≥—Ä–æ–∫ –≤–∑—è–ª –∫–∞—Ä—Ç—É
    const attackerIdx = findPreviousAttackerIndex(0);
    const next = nextNonFinishedIndex(attackerIdx);
    if(next !== null) turnIndex = next;
    endOfTurnCleanup(attackerIdx);
    return;
  }
  if(players[turnIndex] !== players[0]){ log('–ù–µ–ª—å–∑—è –±—Ä–∞—Ç—å: —Å–µ–π—á–∞—Å –Ω–µ –≤–∞—à —Ö–æ–¥'); return; }
  if(players[0].hand.length === 0) return;
  const card = selectedCardUid ? players[0].hand.find(c=>c.uid===selectedCardUid) : players[0].hand[players[0].hand.length-1];
  if(!card) return;
  const idx = players[0].hand.findIndex(c=>c.uid===card.uid);
  const removed = players[0].hand.splice(idx,1)[0];
  discard.push(removed);
  log(`–í—ã –≤—ã–∫–∏–Ω—É–ª–∏ ${removed.rank}${removed.suit} –∏ –±–µ—Ä—ë—Ç–µ –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É`);
  ensureDeck();
  if(deck.length>0) players[0].hand.push(deck.pop()); else log('–ö–æ–ª–æ–¥–∞ –ø—É—Å—Ç–∞ ‚Äî –≤–∑—è—Ç—å –Ω–µ—á–µ–≥–æ');
  selectedCardUid=null; renderAll();
};

/* returnBtn (paid) */
ui.returnBtn.onclick = ()=>{
  if(processing) return;
  if(!tableAttack){ log('–ù–µ—Ç –∞—Ç–∞–∫–∏ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞.'); return; }
  const defenderIdx = nextAliveIndexForHint(turnIndex);
  if(defenderIdx !== 0){ log('–í–µ—Ä–Ω—É—Ç—å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–∞—Å –∞—Ç–∞–∫—É—é—Ç.'); return; }
  const attackerIdx = findPreviousAttackerIndex(defenderIdx);
  // check voucher
  if(useVoucherIfAvailable()){
    log('–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤–∞—É—á–µ—Ä. –í–æ–∑–≤—Ä–∞—Ç –±–µ–∑ —Å–ø–∏—Å–∞–Ω–∏—è ü™ô.');
  } else {
    if(balance < RETURN_COST){ showModal(`–ù—É–∂–Ω–æ ${RETURN_COST} ü™ô —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å –∫–∞—Ä—Ç—É –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é.`); return; }
    balance -= RETURN_COST; saveBalance();
  }
  players[attackerIdx].hand.push(tableAttack);
  players[attackerIdx].skipNextAttack = true;
  log(`–í—ã –≤–µ—Ä–Ω—É–ª–∏ –∫–∞—Ä—Ç—É ${tableAttack.rank}${tableAttack.suit} –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é (${players[attackerIdx].name}).`);
  tableAttack=null; tableDefend=null;
  const next = nextNonFinishedIndex(attackerIdx);
  if(next !== null) turnIndex = next;
  renderAll();
  setTimeout(()=>maybeAutoPlay(), 300);
};

/* lechoBtn - fixed farming */
ui.lechoBtn.onclick = ()=>{
  if(processing) return;
  const p = players[0];
  if(p.antiLecho) { showModal('–í–∞—à–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –õ–µ—á–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ!'); return; }
  if(p.finished) { showModal('–ö–æ–º–±–∏–Ω–∞—Ü–∏—è —Å–æ–±—Ä–∞–Ω–∞ - –æ–∂–∏–¥–∞–π—Ç–µ –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã'); return; }
  const combo = detectCombo(p.hand);
  if(combo){
    p.comboType = combo;
    p.comboCards = [...p.hand];
    p.finished = true;
    balance += 1; saveBalance();
    log(`–í—ã –æ–±—ä—è–≤–∏–ª–∏ –õ–µ—á–æ! (${combo}). +1 ü™ô ‚Äî –±–∞–ª–∞–Ω—Å ${balance}`);
    if(turnIndex === 0){ const n = nextNonFinishedIndex(turnIndex); if(n !== null) turnIndex = n; }
    renderAll(); checkGameEnd(); setTimeout(()=>maybeAutoPlay(), 300);
  } else { showModal('–í—ã –Ω–µ —Å–æ–±—Ä–∞–ª–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é!'); log('–ü–æ–ø—ã—Ç–∫–∞ –æ–±—ä—è–≤–∏—Ç—å –õ–µ—á–æ –±–µ–∑ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏.'); }
};

/* bot main logic */
function maybeAutoPlay(){
  if(processing) return;
  if(checkGameEnd()) return;
  const currentIdx = turnIndex;
  const attacker = players[currentIdx];
  if(!attacker || attacker.finished){
    const next = nextNonFinishedIndex(currentIdx);
    if(next !== null && next !== currentIdx){ turnIndex = next; renderAll(); setTimeout(()=>maybeAutoPlay(),200); return; }
  }
  
  // Handle skip turn
  if(attacker.skipNextAttack){
    attacker.skipNextAttack = false;
    log(`${attacker.name} –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ö–æ–¥ –∏–∑-–∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–æ—Ç–±–∏—Ç–æ–π –∑–∞—â–∏—Ç—ã.`);
    const nextIdx = nextNonFinishedIndex(currentIdx);
    if(nextIdx !== null){
      turnIndex = nextIdx;
      renderAll();
      setTimeout(()=>maybeAutoPlay(), 800);
      return;
    } else {
      turnIndex = (currentIdx + 1) % players.length;
      renderAll();
      setTimeout(()=>maybeAutoPlay(), 800);
      return;
    }
  }
  
  if(tableAttack && !tableDefend){
    const defenderIdx = nextAliveIndexForHint(turnIndex);
    if(defenderIdx === 0) return;
  }
  if(attacker.isHuman){ updateActionHint(); return; }
  processing = true;
  setTimeout(()=>{
    checkLechoForBots();
    const badCards = attacker.hand.map((c,i)=>({c,i,use:cardUsefulness(attacker,c)})).sort((a,b)=>a.use - b.use);
    if(badCards.length > 0 && badCards[0].use < 6 && deck.length > 0 && attacker.hand.length > 1){
      const chosen = badCards[0];
      const removed = attacker.hand.splice(chosen.i,1)[0];
      discard.push(removed);
      log(`${attacker.name} –≤—ã–∫–∏–Ω—É–ª ${removed.rank}${removed.suit} –∏ –±–µ—Ä—ë—Ç –Ω–æ–≤—É—é`);
      ensureDeck();
      if(deck.length > 0) attacker.hand.push(deck.pop());
      renderAll();
      checkLechoForBots();
      setTimeout(()=>maybeAutoPlay(), 600);
      return;
    }
    const defenderIdx = nextAliveIndexForHint(turnIndex);
    const defenderHand = defenderIdx!==null ? players[defenderIdx].hand : [];
    const choices = attacker.hand.map((c,idx)=>{
      const defenderCanBeat = defenderHand.some(d=>{
        if(d.suit === c.suit && RANK_VALUE(d.rank) > RANK_VALUE(c.rank)) return true;
        if(d.suit === trump && c.suit !== trump) return true;
        return false;
      });
      return {c,idx,defenderCanBeat};
    });
    const scored = choices.map(item=>{
      const use = cardUsefulness(attacker,item.c);
      const cantBeatenBonus = item.defenderCanBeat ? 0 : 10;
      const rankFactor = RANK_VALUE(item.c.rank);
      const trumpBonus = item.c.suit===trump ? 4 : 0;
      let score = use - cantBeatenBonus - rankFactor*0.5 - trumpBonus;
      if(!item.defenderCanBeat){
        const tempDefHand = [...defenderHand, item.c];
        if(detectCombo(tempDefHand)) score += 100;
      }
      return {...item,score};
    });
    scored.sort((a,b)=>a.score-b.score);
    const chosen = scored[0] || scored[Math.floor(Math.random()*scored.length)];
    const card = attacker.hand.splice(chosen.idx,1)[0];
    tableAttack = card; tableDefend = null; log(`${attacker.name} –∞—Ç–∞–∫—É–µ—Ç ${card.rank}${card.suit}`); renderAll();
    processing = false;
    setTimeout(()=>resolveDefense(turnIndex, defenderIdx), 600 + Math.floor(Math.random()*400));
  }, 420 + Math.floor(Math.random()*320));
}

function cardUsefulness(player, card){
  let score=0;
  const sameRank = player.hand.filter(c=>c.rank===card.rank).length;
  score += sameRank*10;
  const vals = player.hand.filter(c=>c.suit===card.suit).map(c=>RANK_VALUE(c.rank));
  const v = RANK_VALUE(card.rank);
  if(vals.includes(v-1)) score+=6;
  if(vals.includes(v+1)) score+=6;
  const sameSuit = player.hand.filter(c=>c.suit===card.suit).length;
  score += sameSuit*2;
  if(card.suit===trump) score += 8;
  return score;
}

function ensureDeck(){ if(deck.length===0 && discard.length>0){ log('–ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –æ—Ç–±—Ä–æ—à–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã –≤ –æ—Å–Ω–æ–≤–Ω—É—é –∫–æ–ª–æ–¥—É.'); deck = discard.splice(0); shuffle(deck); } }
function checkGameEnd(){
  const active = players.filter(p=>!p.finished);
  if(active.length <= 1){
    const loser = active[0] || null;
    const winners = players.filter(p=>p.finished);
    const winnersText = winners.map(w=>w.name).join(', ') || '‚Äî';
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–∏–≥—Ä–∞–ª –ª–∏ —á–µ–ª–æ–≤–µ–∫ –≤ –∏–≥—Ä–µ –Ω–∞ —Å—Ç–∞–≤–∫—É
    const humanWon = players[0].finished;
    
    if(!loser){ 
      $('outroTitle').textContent='–ù–∏—á—å—è ‚Äî –≤—Å–µ –æ–±—ä—è–≤–∏–ª–∏ –õ–µ—á–æ'; 
      $('outroText').textContent = `–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏: ${winnersText}`; 
      if (currentLechoBet > 0 && humanWon) {
        const winAmount = Math.round(currentLechoBet * 2.5);
        balance += winAmount;
        winsCount++;
        lechoBettingUnlocked = winsCount >= 3;
        $('outroText').textContent += `\n\nüéâ –í—ã–∏–≥—Ä—ã—à –≤ –∏–≥—Ä–µ –Ω–∞ —Å—Ç–∞–≤–∫—É: +${winAmount}ü™ô!`;
        currentLechoBet = 0;
        saveBalance();
        updateLechoBettingButton();
      } else if (humanWon) {
        // –û–±—ã—á–Ω–∞—è –ø–æ–±–µ–¥–∞ - —Ç–æ–∂–µ —Å—á–∏—Ç–∞–µ–º –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
        winsCount++;
        lechoBettingUnlocked = winsCount >= 3;
        saveBalance();
        updateLechoBettingButton();
      }
      showScreen('screenOutro'); 
    }
    else { 
      $('outroTitle').textContent = `–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞ ‚Äî –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏–π: ${loser.name}`; 
      $('outroText').textContent = `–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏: ${winnersText}`; 
      
      if (currentLechoBet > 0 && humanWon) {
        const winAmount = Math.round(currentLechoBet * 2.5);
        balance += winAmount;
        winsCount++;
        lechoBettingUnlocked = winsCount >= 3;
        $('outroText').textContent += `\n\nüéâ –í—ã–∏–≥—Ä—ã—à –≤ –∏–≥—Ä–µ –Ω–∞ —Å—Ç–∞–≤–∫—É: +${winAmount}ü™ô!`;
        currentLechoBet = 0;
        saveBalance();
        updateLechoBettingButton();
      } else if (currentLechoBet > 0 && !humanWon) {
        $('outroText').textContent += `\n\nüí∏ –ü—Ä–æ–∏–≥—Ä—ã—à –≤ –∏–≥—Ä–µ –Ω–∞ —Å—Ç–∞–≤–∫—É: -${currentLechoBet}ü™ô`;
        currentLechoBet = 0;
        saveBalance();
      } else if (humanWon) {
        // –û–±—ã—á–Ω–∞—è –ø–æ–±–µ–¥–∞ - —Ç–æ–∂–µ —Å—á–∏—Ç–∞–µ–º –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
        winsCount++;
        lechoBettingUnlocked = winsCount >= 3;
        saveBalance();
        updateLechoBettingButton();
      }
      
      if(loser.isHuman){ showScreen('screenGuess'); renderGuess(); } else { showScreen('screenOutro'); } 
    }
    return true;
  }
  return false;
}

function checkLechoForBots(){
  for(const p of players){
    if(p.isHuman || p.finished || p.antiLecho) continue;
    const combo = detectCombo(p.hand);
    if(combo){
      p.finished = true;
      p.comboType = combo;
      p.comboCards = [...p.hand];
      log(`${p.name} –æ–±—ä—è–≤–∏–ª –õ–µ—á–æ! (${combo})`);
      if(turnIndex === p.id){
        const next = nextNonFinishedIndex(turnIndex);
        if(next !== null) turnIndex = next;
      }
    }
  }
  checkGameEnd();
}

function renderGuess(){
  const winners = players.filter(p=>p.finished);
  const forms = $('guessForms');
  forms.innerHTML='';
  winners.forEach(w => {
    const div = document.createElement('div');
    div.style.marginBottom = '20px';
    div.innerHTML = `<h4>–î–ª—è ${w.name} (${w.comboType})</h4>`;
    let guessHtml = '';
    if(w.comboType === '–ü–æ–≤—Ç–æ—Ä'){
      guessHtml = `–£–≥–∞–¥–∞–π—Ç–µ —Ä–∞–Ω–≥: <select id="guess_rank_${w.id}">${RANKS.map(r=>`<option value="${r}">${r}</option>`).join('')}</select><br>`;
    } else if(w.comboType === '–ú–∞—Å—Ç—å'){
      guessHtml = `–£–≥–∞–¥–∞–π—Ç–µ –º–∞—Å—Ç—å: <select id="guess_suit_${w.id}">${SUITS.map(s=>`<option value="${s}">${s}</option>`).join('')}</select><br>`;
    } else if(w.comboType === '–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å'){
      const possibleStarts = RANKS.slice(0, RANKS.length - 2);
      guessHtml = `–£–≥–∞–¥–∞–π—Ç–µ —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —Ä–∞–Ω–≥ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: <select id="guess_start_${w.id}">${possibleStarts.map(r=>`<option value="${r}">${r} ${RANKS[RANK_VALUE(r)+1]} ${RANKS[RANK_VALUE(r)+2]}</option>`).join('')}</select><br>`;
    }
    div.innerHTML += guessHtml;
    forms.appendChild(div);
  });
}

$('submitGuess').onclick = ()=>{
  const winners = players.filter(p=>p.finished);
  let results = [];
  let guessedCount = 0;
  winners.forEach(w => {
    let guessed = null; let actual = null;
    if(w.comboType === '–ü–æ–≤—Ç–æ—Ä'){ guessed = $(`guess_rank_${w.id}`).value; actual = w.comboCards[0].rank; }
    else if(w.comboType === '–ú–∞—Å—Ç—å'){ guessed = $(`guess_suit_${w.id}`).value; actual = w.comboCards[0].suit; }
    else if(w.comboType === '–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å'){ guessed = $(`guess_start_${w.id}`).value; const minVal = Math.min(...w.comboCards.map(c => RANK_VALUE(c.rank))); actual = RANKS[minVal]; }
    if(guessed === actual){ 
      log(`–£–≥–∞–¥–∞–ª–∏ –¥–ª—è ${w.name}!`);
      results.push(`–£–≥–∞–¥–∞–ª–∏ –¥–ª—è ${w.name}: ${w.comboType}`);
      guessedCount++;
    } else { 
      log(`–ù–µ —É–≥–∞–¥–∞–ª–∏ –¥–ª—è ${w.name}.`);
      const pulls = simulatePull(); 
      log(`–ó–∞ ${w.name}: –≤—ã—Ç—è–Ω—É—Ç–æ ${pulls} –∫–∞—Ä—Ç.`);
      results.push(`–ù–µ —É–≥–∞–¥–∞–ª–∏ –¥–ª—è ${w.name}: ${w.comboType} (–≤—ã—Ç—è–Ω—É—Ç–æ ${pulls} –∫–∞—Ä—Ç)`);
      if(pulls > 15) log(`–ö–æ–ª–æ–¥–∞ –∑–∞ ${w.name}! –ü—Ä–æ–∏–≥—Ä–∞–ª–∏ –¥–≤–∞–∂–¥—ã.`);
    }
  });
  if (guessedCount > 0) {
    diamonds += guessedCount;
    log(`+${guessedCount} üíé –∑–∞ —É–≥–∞–¥–∞–Ω–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏`);
    saveBalance();
  }
  $('outroTitle').textContent = '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —É–≥–∞–¥—ã–≤–∞–Ω–∏–π';
  $('outroText').innerHTML = results.join('<br>');
  showScreen('screenOutro');
};

function simulatePull(){
  let pulls = 0;
  const newDeck = makeDeck();
  shuffle(newDeck);
  while(newDeck.length >= 3){
    const three = [];
    for(let i=0;i<3;i++) three.push(newDeck.pop());
    pulls += 3;
    if(!detectCombo(three)) break;
  }
  return pulls;
}

/* outro buttons */
$('playAgain').onclick = () => { startNewGame(); };

/* helpers */
function showScreen(name){ ['screenIntro','screenGame','screenProfile','screenRules','screenShop','screenOutro','screenGuess','screenExchange','screenCasino','screenSlots','screenHorseRace','screenLechoBetting'].forEach(id=>{ const el=$(id); if(el) el.classList.remove('active'); }); $(name).classList.add('active'); }

// –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –∏–≥—Ä—ã –Ω–∞ —Å—Ç–∞–≤–∫—É
function updateLechoBettingButton() {
  const btn = $('btnLechoBetting');
  const progress = $('winsProgress');
  if (btn) {
    // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    console.log(`winsCount: ${winsCount}, lechoBettingUnlocked: ${lechoBettingUnlocked}`);
    
    if (lechoBettingUnlocked) {
      btn.style.opacity = '1';
      btn.style.cursor = 'pointer';
      btn.style.background = 'linear-gradient(135deg, #ffd700, #ffed4e)';
      btn.style.color = '#111';
      btn.style.boxShadow = '0 10px 24px rgba(255, 215, 0, 0.4)';
      btn.title = '–ò–≥—Ä–∞—Ç—å –≤ –õ–µ—á–æ –Ω–∞ —Å—Ç–∞–≤–∫—É';
      btn.onclick = () => showScreen('screenLechoBetting');
      if (progress) progress.textContent = '‚úì';
    } else {
      btn.style.opacity = '0.5';
      btn.style.cursor = 'not-allowed';
      btn.style.background = 'var(--accent)';
      btn.style.color = '#111';
      btn.style.boxShadow = '0 10px 24px rgba(0,0,0,0.28)';
      btn.title = `–û—Ç–∫—Ä–æ–µ—Ç—Å—è –ø–æ—Å–ª–µ 3 –ø–æ–±–µ–¥ (${winsCount}/3)`;
      btn.onclick = () => showModal(`–ù—É–∂–Ω–æ ${3 - winsCount} –ø–æ–±–µ–¥ –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏–≥—Ä—ã –Ω–∞ —Å—Ç–∞–≤–∫—É`);
      if (progress) progress.textContent = `(${winsCount}/3)`;
    }
  }
}
saveBalance();
updateLechoBettingButton();
showScreen('screenIntro');

/* ============== SHOP: initial mechanics ============== */
function renderShop(){
  const grid = $('shopGrid'); grid.innerHTML='';
  SHOP_ITEMS.forEach(it=>{
    const div = document.createElement('div'); div.className='shop-item';
    // –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ
    const camelId = snakeToCamel(it.id);
    const translatedTitle = t(camelId) || it.title;
    const translatedDesc = t(camelId + 'Desc') || it.desc;
    div.innerHTML = `<div class="item-title">${translatedTitle}</div><div class="item-desc">${translatedDesc}</div><div style="display:flex;justify-content:space-between;align-items:center"><div class="price">ü™ô ${it.price}</div><div><button class="big-btn buyBtn" data-id="${it.id}">${t('buy')}</button></div></div>`;
    grid.appendChild(div);
  });
  document.querySelectorAll('.buyBtn').forEach(b=>b.addEventListener('click', ()=>{ const id=b.dataset.id; buyItem(id); }));
}
renderShop();

function inventoryLoad(){ try{ return JSON.parse(sessionStorage.getItem(SHOP_KEY)||'{}'); }catch(e){ return {}; } }
function inventorySave(inv){ sessionStorage.setItem(SHOP_KEY, JSON.stringify(inv)); updateInventoryUI(); }

function buyItem(id){
  const item = SHOP_ITEMS.find(x=>x.id===id); if(!item) return;
  if(balance < item.price){ showModal('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ü™ô'); return; }
  balance -= item.price; saveBalance();
  const inv = inventoryLoad();
  inv[id] = (inv[id] || 0) + (item.qty || 1);
  inventorySave(inv);
  log(`–ö—É–ø–ª–µ–Ω–æ: ${item.title} –∑–∞ ${item.price} ü™ô`);
  // apply immediate effects
  if(item.type === 'theme'){ 
    document.body.style.background = 'linear-gradient(180deg,#071b16,#03140f)'; 
    log('–¢–µ–º–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞.'); 
  }
  if(item.type === 'avatar'){ 
    const pack = AVATAR_PACKS[id] || [];
    const currentAvs = JSON.parse(sessionStorage.getItem(AVATARS_KEY) || '[]');
    sessionStorage.setItem(AVATARS_KEY, JSON.stringify([...new Set([...currentAvs, ...pack])]));
    log('–ù–∞–±–æ—Ä –∞–≤–∞—Ç–∞—Ä–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –≤—ã–±–æ—Ä–∞.'); 
  }
  if(item.type === 'voucher'){ log(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${item.qty||1} –≤–∞—É—á–µ—Ä–æ–≤ –Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç.`); }
  if(item.type === 'hint'){ log('–•–∏–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.'); }
  if(item.type === 'extra_draw'){ log('–î–æ–ø. –≤—ã—Ç—è–∂–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.'); }
  if(item.type === 'peek'){ log('–ü–æ–¥–≥–ª—è–¥ –≤ –∫–æ–ª–æ–¥—É –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.'); }
  if(item.type === 'skip'){ log('–ü—Ä–æ–ø—É—Å–∫ —Ö–æ–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.'); }
  if(item.type === 'reveal'){ log('–†–∞–∑–æ–±–ª–∞—á–µ–Ω–∏–µ –∫–æ–º–±–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.'); }
  if(item.type === 'extra_life'){ log('–î–æ–ø. –∂–∏–∑–Ω—å –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.'); }
  if(item.type === 'telepathy'){ log('–¢–µ–ª–µ–ø–∞—Ç–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.'); }
  if(item.type === 'trump_swap'){ log('–ü–æ–¥–º–µ–Ω–∞ –ö–æ–∑—ã—Ä—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.'); }
  if(item.type === 'game_roulette'){ log('–†—É—Å—Å–∫–∞—è –†—É–ª–µ—Ç–∫–∞ –≤ –ò–≥—Ä–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.'); }
  if(item.type === 'anti_lecho'){ log('–ê–Ω—Ç–∏-–õ–µ—á–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.'); }
  if(item.type === 'bet_doubler'){ log('–£–¥–≤–æ–∏—Ç–µ–ª—å –°—Ç–∞–≤–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.'); }
  if(item.type === 'insurance'){ log('–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.'); }
  if(item.type === 'free_sample'){ log('–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –û–±—Ä–∞–∑–µ—Ü –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.'); }
}

/* inventory UI */
function updateInventoryUI(){
  const inv = inventoryLoad();
  ui.inventory.innerHTML = '';
  Object.keys(inv).forEach(k=>{
    const cnt = inv[k];
    const display = SHOP_ITEMS.find(x=>x.id===k)?.title || k;
    const el = document.createElement('div'); el.className='chip'; el.textContent = `${display} √ó${cnt}`;
    ui.inventory.appendChild(el);
  });
}

function updateGameInventory() {
  const inv = inventoryLoad();
  ui.gameInventory.innerHTML = '';
  Object.keys(inv).forEach(k => {
    if (inv[k] <= 0) return;
    const item = SHOP_ITEMS.find(x => x.id === k);
    if (!item) return;
    const div = document.createElement('div');
    div.className = 'game-inv-item';
    div.innerHTML = `<span>${item.title} √ó${inv[k]}</span><button class="use-btn" data-id="${k}">${t('use')}</button>`;
    ui.gameInventory.appendChild(div);
  });
  ui.gameInventory.querySelectorAll('.use-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const id = btn.dataset.id;
      useItemInGame(id);
    });
  });
}

function useItemInGame(id) {
  const inv = inventoryLoad();
  if (inv[id] <= 0) return;
  const item = SHOP_ITEMS.find(x => x.id === id);
  if (!item) return;
  if (item.type !== 'free_sample') {
    inv[id]--;
    inventorySave(inv);
  }
  log(`${item.title} –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ.`);
  useItemEffect(item.type, false); // false for no decrement in free sample
  updateGameInventory();
  renderPersonalization();
}

function useItemEffect(type, isFreeSample = false) {
  if (type === 'hint') {
    const p = players[0];
    const possibleCombos = [];
    for (let i = 0; i < p.hand.length; i++) {
      for (let j = i+1; j < p.hand.length; j++) {
        for (let k = j+1; k < p.hand.length; k++) {
          const temp = [p.hand[i], p.hand[j], p.hand[k]];
          const combo = detectCombo(temp);
          if (combo) possibleCombos.push(`${temp.map(c => c.rank + c.suit).join(' ')} (${combo})`);
        }
      }
    }
    if (possibleCombos.length > 0) {
      showModal(`–í–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏: ${possibleCombos.join('; ')}`);
    } else {
      showModal('–ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π');
    }
  } else if (type === 'peek') {
    if (deck.length > 0) {
      const top = deck[deck.length - 1];
      showModal(`–í–µ—Ä—Ö –∫–æ–ª–æ–¥—ã: ${top.rank}${top.suit}`);
    } else {
      showModal('–ö–æ–ª–æ–¥–∞ –ø—É—Å—Ç–∞');
    }
  } else if (type === 'skip') {
    players[0].skipNextAttack = true;
    log('–í–∞—à —Å–ª–µ–¥—É—é—â–∏–π —à–∞–Ω—Å –∞—Ç–∞–∫–∏ –ø—Ä–æ–ø—É—â–µ–Ω');
  } else if (type === 'reveal') {
    const aliveBots = players.filter(p => !p.isHuman && !p.finished);
    if (aliveBots.length > 0) {
      const randomBot = aliveBots[Math.floor(Math.random() * aliveBots.length)];
      const botCombo = detectCombo(randomBot.hand);
      showModal(`${randomBot.name} –∏–º–µ–µ—Ç: ${botCombo || '–Ω–µ—Ç –∫–æ–º–±–æ'}`);
    } else {
      showModal('–ù–µ—Ç –±–æ—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–æ–±–ª–∞—á–µ–Ω–∏—è');
    }
  } else if (type === 'extra_draw') {
    if (players[0].hand.length > 0) {
      const card = players[0].hand.pop();
      discard.push(card);
      log(`–í—ã–∫–∏–Ω—É—Ç–∞ ${card.rank}${card.suit} –±–µ–∑ –≤—ã—Ç—è–∂–∫–∏`);
      renderAll();
    }
  } else if (type === 'extra_life') {
    log('–î–æ–ø. –∂–∏–∑–Ω—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –¥–ª—è –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã');
  } else if (type === 'telepathy') {
    const aliveBots = players.filter(p => !p.isHuman && !p.finished);
    if (aliveBots.length > 0) {
      const randomBot = aliveBots[Math.floor(Math.random() * aliveBots.length)];
      if (randomBot.hand.length > 0) {
        const randomCard = randomBot.hand[Math.floor(Math.random() * randomBot.hand.length)];
        showModal(`–£ ${randomBot.name}: ${randomCard.rank}${randomCard.suit}`);
      }
    } else {
      showModal('–ù–µ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤');
    }
  } else if (type === 'trump_swap') {
    if (!trumpSwapped) {
      trump = SUITS[Math.floor(Math.random() * SUITS.length)];
      trumpSwapped = true;
      log(`–ö–æ–∑—ã—Ä—å —Å–º–µ–Ω–µ–Ω –Ω–∞ ${trump}!`);
      $('trumpCard').textContent = trump;
    } else {
      showModal('–ö–æ–∑—ã—Ä—å —É–∂–µ —Å–º–µ–Ω–µ–Ω!');
    }
  } else if (type === 'game_roulette') {
    const aliveBots = players.filter(p => !p.isHuman && !p.finished);
    if (aliveBots.length > 0) {
      const randomBot = aliveBots[Math.floor(Math.random() * aliveBots.length)];
      if (Math.random() < 0.5) {
        randomBot.skipNextAttack = true;
        log(`${randomBot.name} –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ö–æ–¥ –∏–∑-–∑–∞ —Ä—É–ª–µ—Ç–∫–∏!`);
      } else {
        log(`${randomBot.name} –∏–∑–±–µ–∂–∞–ª —Ä—É–ª–µ—Ç–∫–∏.`);
      }
    } else {
      showModal('–ù–µ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤');
    }
  } else if (type === 'anti_lecho') {
    const aliveBots = players.filter(p => !p.isHuman && !p.finished);
    if (aliveBots.length > 0) {
      const randomBot = aliveBots[Math.floor(Math.random() * aliveBots.length)];
      randomBot.antiLecho = true;
      log(`–ê–Ω—Ç–∏-–õ–µ—á–æ –Ω–∞–ª–æ–∂–µ–Ω–æ –Ω–∞ ${randomBot.name}!`);
    } else {
      showModal('–ù–µ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤');
    }
  } else if (type === 'bet_doubler') {
    betDoublerActive = true;
    showModal('–£–¥–≤–æ–∏—Ç–µ–ª—å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–±–µ–¥—ã –≤ –∫–∞–∑–∏–Ω–æ');
  } else if (type === 'insurance') {
    insuranceActive = true;
    showModal('–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø—Ä–æ–∏–≥—Ä—ã—à–∞ –≤ –∫–∞–∑–∏–Ω–æ');
  } else if (type === 'free_sample') {
    const itemId = prompt('–í–≤–µ–¥–∏—Ç–µ ID –ø—Ä–µ–¥–º–µ—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, hint):');
    if (itemId) {
      const testItem = SHOP_ITEMS.find(x => x.id === itemId);
      if (testItem) {
        useItemEffect(testItem.type, true);
      } else {
        showModal('–ü—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
      }
    }
  }
}

/* personalization UI */
function renderPersonalization() {
  const grid = $('personalizationGrid');
  grid.innerHTML = '';
  const inv = inventoryLoad();
  Object.keys(inv).forEach(k => {
    const item = SHOP_ITEMS.find(x => x.id === k);
    if (!item || inv[k] <= 0) return;
    const div = document.createElement('div');
    div.className = 'personalization-item';
    div.innerHTML = `<div class="item-title">${item.title} √ó${inv[k]}</div><button class="apply-btn" data-id="${k}">${t('apply')}</button>`;
    grid.appendChild(div);
  });
  document.querySelectorAll('.apply-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const id = btn.dataset.id;
      const item = SHOP_ITEMS.find(x => x.id === id);
      if (!item) return;
      // simple apply for now (extend as needed)
      if (item.type === 'theme') {
        document.body.style.background = 'linear-gradient(180deg,#071b16,#03140f)';
        log(`${item.title} –ø—Ä–∏–º–µ–Ω–µ–Ω–æ.`);
      } else if (item.type === 'avatar') {
        log('–ê–≤–∞—Ç–∞—Ä—ã —É–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Å–µ–ª–µ–∫—Ç–µ –ø—Ä–æ—Ñ–∏–ª—è.');
      } else {
        // for consumables, decrement if >0
        const inv = inventoryLoad();
        if (inv[id] > 0) {
          inv[id]--;
          inventorySave(inv);
          useItemEffect(item.type, false);
          log(`${item.title} –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ.`);
        }
        renderPersonalization();
      }
    });
  });
}

/* expose small helper: use voucher to add a free return (consume voucher instead of money) */
function useVoucherIfAvailable(){
  const inv = inventoryLoad();
  if((inv['voucher_pack']||0) > 0){
    inv['voucher_pack'] -= 1; inventorySave(inv);
    return true;
  }
  return false;
}

/* init: load inventory and balance preview */
updateInventoryUI();
saveBalance();

/* Telegram WebApp support */
// Viewport fit for Telegram Mini Apps
function applyAppHeight(h){
  document.documentElement.style.setProperty('--app-height', h + 'px');
}
function computeAppHeight(){
  if (window.Telegram && Telegram.WebApp && Telegram.WebApp.viewportHeight) {
    return Math.round(Telegram.WebApp.viewportHeight * window.devicePixelRatio ? (Telegram.WebApp.viewportHeight) : Telegram.WebApp.viewportHeight);
  }
  return window.innerHeight;
}
function syncAppHeight(){ applyAppHeight(computeAppHeight()); }
syncAppHeight();
if (window.Telegram && Telegram.WebApp) {
  Telegram.WebApp.ready();
  Telegram.WebApp.expand();
  if (Telegram.WebApp.onEvent) {
    Telegram.WebApp.onEvent('viewportChanged', syncAppHeight);
  }
}
window.addEventListener('resize', syncAppHeight);

// Floating inventory toggle removed - inventory is now always visible in game

/* keep global access for debugging */
window._lecho = { startNewGame, renderShop, inventoryLoad, inventorySave };

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–∑—ã–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–º–µ–Ω—ã (–≤ —Å–∞–º–æ–º –∫–æ–Ω—Ü–µ, –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —è–∑—ã–∫...');
  initLanguage();
  const languageSelect = $('languageSelect');
  if (languageSelect) {
    console.log('–ù–∞–π–¥–µ–Ω languageSelect, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫...');
    languageSelect.addEventListener('change', (e) => {
      console.log('–°–º–µ–Ω–∞ —è–∑—ã–∫–∞ –Ω–∞:', e.target.value);
      changeLanguage(e.target.value);
    });
  } else {
    console.log('languageSelect –Ω–µ –Ω–∞–π–¥–µ–Ω!');
  }
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
  loadPlayerDataOnInit().then(() => {
    console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
    saveBalance(); // –û–±–Ω–æ–≤–ª—è–µ–º UI –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
  });
});

// –ï—Å–ª–∏ DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ä–∞–∑—É
if (document.readyState === 'loading') {
  // DOM –µ—â–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –∂–¥–µ–º —Å–æ–±—ã—Ç–∏—è DOMContentLoaded
  console.log('DOM –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –∂–¥–µ–º DOMContentLoaded...');
} else {
  // DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ä–∞–∑—É
  console.log('DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —è–∑—ã–∫ —Å—Ä–∞–∑—É...');
  initLanguage();
  const languageSelect = $('languageSelect');
  if (languageSelect) {
    console.log('–ù–∞–π–¥–µ–Ω languageSelect, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫...');
    languageSelect.addEventListener('change', (e) => {
      console.log('–°–º–µ–Ω–∞ —è–∑—ã–∫–∞ –Ω–∞:', e.target.value);
      changeLanguage(e.target.value);
    });
  } else {
    console.log('languageSelect –Ω–µ –Ω–∞–π–¥–µ–Ω!');
  }
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
  loadPlayerDataOnInit().then(() => {
    console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
    saveBalance(); // –û–±–Ω–æ–≤–ª—è–µ–º UI –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
  });
}
</script>
</body>
</html>
